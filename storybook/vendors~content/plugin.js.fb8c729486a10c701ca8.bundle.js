(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1276:function(module,exports,__webpack_require__){var $=__webpack_require__(18),fill=__webpack_require__(1296),addToUnscopables=__webpack_require__(209);$({target:"Array",proto:!0},{fill:fill}),addToUnscopables("fill")},1296:function(module,exports,__webpack_require__){"use strict";var toObject=__webpack_require__(89),toAbsoluteIndex=__webpack_require__(270),toLength=__webpack_require__(80);module.exports=function fill(value){for(var O=toObject(this),length=toLength(O.length),argumentsLength=arguments.length,index=toAbsoluteIndex(argumentsLength>1?arguments[1]:void 0,length),end=argumentsLength>2?arguments[2]:void 0,endPos=void 0===end?length:toAbsoluteIndex(end,length);endPos>index;)O[index++]=value;return O}},1297:function(module,exports){function _typeof(obj){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?module.exports=_typeof=function _typeof(obj){return typeof obj}:module.exports=_typeof=function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}module.exports=_typeof},1298:function(module,exports){module.exports=function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}},1299:function(module,exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}module.exports=function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}},1300:function(module,exports,__webpack_require__){!function webpackUniversalModuleDefinition(root,factory){module.exports=factory()}("undefined"!=typeof self&&self,(function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=8)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ComparatorMap}));var _operator_packages__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);let ComparatorMap={js:(val,val2)=>val===val2?0:val<val2?-1:1,"abstract-js":(val,val2)=>val==val2?0:val<val2?-1:1,"abstract-date":function CreateAbstractDateJavascriptComparator(){return(val,val2)=>{let v1=new Date(val).toISOString(),v2=new Date(val2).toISOString();return v1==v2?0:v1<v2?-1:1}}(),loki:function CreateLokiComparator(){return(val,val2)=>Object(_operator_packages__WEBPACK_IMPORTED_MODULE_0__.b)(val,val2)?0:Object(_operator_packages__WEBPACK_IMPORTED_MODULE_0__.c)(val,val2,!1)?-1:1}()}},function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global){function getGlobal(){let glob;return function(global){glob=global}(void 0!==global&&global||this),glob}__webpack_require__.d(__webpack_exports__,"a",(function(){return PLUGINS}));const PLUGINS=function create(){const global=getGlobal(),sym=Symbol.for("LOKI");return void 0===global[sym]&&(global[sym]={}),global[sym]}()}).call(this,__webpack_require__(7))},function(module,__webpack_exports__,__webpack_require__){"use strict";function aeqHelper(prop1,prop2){if(prop1===prop2)return!0;if(!prop1||!prop2||!0===prop1||!0===prop2||prop1!=prop1||prop2!=prop2){let t1,t2;switch(prop1){case void 0:case null:t1=1;break;case!1:t1=3;break;case!0:t1=4;break;case"":t1=5;break;default:t1=prop1==prop1?9:0}switch(prop2){case void 0:case null:t2=1;break;case!1:t2=3;break;case!0:t2=4;break;case"":t2=5;break;default:t2=prop2==prop2?9:0}if(9!==t1||9!==t2)return t1===t2}let cv1=Number(prop1),cv2=Number(prop2);return cv1==cv1||cv2==cv2?cv1===cv2:(cv1=prop1.toString(),cv2=prop2.toString(),cv1==cv2)}function ltHelper(prop1,prop2,equal){if(!prop1||!prop2||!0===prop1||!0===prop2||prop1!=prop1||prop2!=prop2){let t1,t2;switch(prop1){case void 0:case null:t1=1;break;case!1:t1=3;break;case!0:t1=4;break;case"":t1=5;break;default:t1=prop1==prop1?9:0}switch(prop2){case void 0:case null:t2=1;break;case!1:t2=3;break;case!0:t2=4;break;case"":t2=5;break;default:t2=prop2==prop2?9:0}if(9!==t1||9!==t2)return t1===t2?equal:t1<t2}let cv1=Number(prop1),cv2=Number(prop2);return cv1==cv1&&cv2==cv2?cv1<cv2||!(cv1>cv2)&&equal:cv1==cv1&&cv2!=cv2||(cv2!=cv2||cv1==cv1)&&(prop1<prop2||!(prop1>prop2)&&(prop1==prop2?equal:(cv1=prop1.toString(),cv2=prop2.toString(),cv1<cv2||cv1==cv2&&equal)))}function gtHelper(prop1,prop2,equal){if(!prop1||!prop2||!0===prop1||!0===prop2||prop1!=prop1||prop2!=prop2){let t1,t2;switch(prop1){case void 0:case null:t1=1;break;case!1:t1=3;break;case!0:t1=4;break;case"":t1=5;break;default:t1=prop1==prop1?9:0}switch(prop2){case void 0:case null:t2=1;break;case!1:t2=3;break;case!0:t2=4;break;case"":t2=5;break;default:t2=prop2==prop2?9:0}if(9!==t1||9!==t2)return t1===t2?equal:t1>t2}let cv1=Number(prop1),cv2=Number(prop2);return cv1==cv1&&cv2==cv2?cv1>cv2||!(cv1<cv2)&&equal:(cv1!=cv1||cv2==cv2)&&(cv2==cv2&&cv1!=cv1||(prop1>prop2||!(prop1<prop2)&&(prop1==prop2?equal:(cv1=prop1.toString(),cv2=prop2.toString(),cv1>cv2||cv1==cv2&&equal))))}function sortHelper(prop1,prop2,descending){return aeqHelper(prop1,prop2)?0:ltHelper(prop1,prop2,!1)?descending?1:-1:gtHelper(prop1,prop2,!1)?descending?-1:1:0}__webpack_require__.d(__webpack_exports__,"b",(function(){return aeqHelper})),__webpack_require__.d(__webpack_exports__,"c",(function(){return ltHelper})),__webpack_require__.d(__webpack_exports__,"d",(function(){return sortHelper})),__webpack_require__.d(__webpack_exports__,"a",(function(){return LokiOperatorPackageMap}));class LokiOperatorPackage{$eq(a,b){return a===b}$ne(a,b){return a!==b}$gt(a,b){return a>b}$gte(a,b){return a>=b}$lt(a,b){return a<b}$lte(a,b){return a<=b}$between(a,range){return null!=a&&(a>=range[0]&&a<=range[1])}$in(a,b){return-1!==b.indexOf(a)}$nin(a,b){return-1===b.indexOf(a)}$keyin(a,b){return a in b}$nkeyin(a,b){return!(a in b)}$definedin(a,b){return void 0!==b[a]}$undefinedin(a,b){return void 0===b[a]}$regex(a,b){return b.test(a)}$containsNone(a,b){return!this.$containsAny(a,b)}$containsAny(a,b){const checkFn=this.containsCheckFn(a);return null!==checkFn&&(Array.isArray(b)?b.some(checkFn):checkFn(b))}$contains(a,b){const checkFn=this.containsCheckFn(a);return null!==checkFn&&(Array.isArray(b)?b.every(checkFn):checkFn(b))}$type(a,b){let type=typeof a;return"object"===type&&(Array.isArray(a)?type="array":a instanceof Date&&(type="date")),"object"!=typeof b?type===b:this.doQueryOp(type,b)}$finite(a,b){return b===isFinite(a)}$size(a,b){return!!Array.isArray(a)&&("object"!=typeof b?a.length===b:this.doQueryOp(a.length,b))}$len(a,b){return"string"==typeof a&&("object"!=typeof b?a.length===b:this.doQueryOp(a.length,b))}$where(a,b){return!0===b(a)}$not(a,b){return!this.doQueryOp(a,b)}$and(a,b){for(let idx=0,len=b.length;idx<len;idx++)if(!this.doQueryOp(a,b[idx]))return!1;return!0}$or(a,b){for(let idx=0,len=b.length;idx<len;idx++)if(this.doQueryOp(a,b[idx]))return!0;return!1}doQueryOp(val,op){for(let p in op)if(Object.hasOwnProperty.call(op,p))return this[p](val,op[p]);return!1}containsCheckFn(a){return"string"==typeof a||Array.isArray(a)?b=>-1!==a.indexOf(b):"object"==typeof a&&null!==a?b=>Object.hasOwnProperty.call(a,b):null}}let LokiOperatorPackageMap={js:new LokiOperatorPackage,loki:new class LokiAbstractOperatorPackage extends LokiOperatorPackage{constructor(){super()}$eq(a,b){return aeqHelper(a,b)}$ne(a,b){return!aeqHelper(a,b)}$gt(a,b){return gtHelper(a,b,!1)}$gte(a,b){return gtHelper(a,b,!0)}$lt(a,b){return ltHelper(a,b,!1)}$lte(a,b){return ltHelper(a,b,!0)}$between(a,range){return null!=a&&(gtHelper(a,range[0],!0)&&ltHelper(a,range[1],!0))}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var event_emitter=__webpack_require__(5);class UniqueIndex{constructor(propertyField){this._field=propertyField,this._lokiMap={},this._valMap={}}set(id,value){if(null!=value){if(value in this._lokiMap)throw new Error("Duplicate key for property "+this._field+": "+value);if(id in this._valMap)throw new Error("Duplicate key for property $loki : "+id);this._lokiMap[value]=id,this._valMap[id]=value}}get(value){return this._lokiMap[value]}update(id,value){if(value!==this._valMap[id]){if(value in this._lokiMap)throw new Error("Duplicate key for property "+this._field+": "+value);this.remove(id),this.set(id,value)}}remove(id){if(!(id in this._valMap))throw new Error("Key is not in unique index: "+this._field);let oldValue=this._valMap[id];delete this._lokiMap[oldValue],delete this._valMap[id]}clear(){this._lokiMap={},this._valMap={}}}function add(copy,key,value){return copy instanceof Array?(copy.push(value),copy[copy.length-1]):copy instanceof Object?(copy[key]=value,copy[key]):void 0}function deepCopy(target){if(/number|string|boolean/.test(typeof target))return target;if(target instanceof Date)return new Date(target.getTime());const copy=target instanceof Array?[]:{};return function walk(target,copy){for(let key in target){let obj=target[key];if(obj instanceof Date){add(copy,key,new Date(obj.getTime()))}else if(obj instanceof Function){add(copy,key,obj)}else if(obj instanceof Array){walk(obj,add(copy,key,[]))}else if(obj instanceof Object){walk(obj,add(copy,key,{}))}else{add(copy,key,obj)}}}(target,copy),copy}function clone(data,method="parse-stringify"){if(null==data)return null;let cloned;switch(method){case"parse-stringify":cloned=JSON.parse(JSON.stringify(data));break;case"deep":cloned=deepCopy(data);break;case"shallow":cloned=Object.create(data.constructor.prototype),Object.assign(cloned,data);break;case"shallow-recurse":cloned=clone(data,"shallow");const keys=Object.keys(data);for(let i=0;i<keys.length;i++){const key=keys[i];"object"==typeof data[key]&&"Object"===data[key].constructor.name&&(cloned[key]=clone(data[key],"shallow-recurse"))}}return cloned}var operator_packages=__webpack_require__(2),comparators=__webpack_require__(0);function resolveTransformObject(subObj,params,depth=0){if(++depth>=10)return subObj;for(const prop in subObj)if("string"==typeof subObj[prop]&&0===subObj[prop].indexOf("[%lktxp]")){const pname=subObj[prop].substring(8);void 0!==params[pname]&&(subObj[prop]=params[pname])}else"object"==typeof subObj[prop]&&(subObj[prop]=resolveTransformObject(subObj[prop],params,depth));return subObj}const indexedOps={$eq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};class result_set_ResultSet{constructor(collection){this._filteredRows=[],this._filterInitialized=!1,this._scoring=null,this._collection=collection}reset(){return this._filteredRows.length>0&&(this._filteredRows=[]),this._filterInitialized=!1,this}toJSON(){const copy=this.copy();return copy._collection=null,copy}limit(qty){return this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex()),this._filteredRows=this._filteredRows.slice(0,qty),this._filterInitialized=!0,this}offset(pos){return this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex()),this._filteredRows=this._filteredRows.slice(pos),this._filterInitialized=!0,this}copy(){const result=new result_set_ResultSet(this._collection);return result._filteredRows=this._filteredRows.slice(),result._filterInitialized=this._filterInitialized,result}transform(transform,parameters){"string"==typeof transform&&(transform=this._collection._transforms[transform]),void 0!==parameters&&(transform=function resolveTransformParams(transform,params){if(void 0===params)return transform;const resolvedTransform=[];for(let idx=0;idx<transform.length;idx++){const clonedStep=clone(transform[idx],"shallow-recurse");resolvedTransform.push(resolveTransformObject(clonedStep,params))}return resolvedTransform}(transform,parameters));let rs=this;for(let idx=0;idx<transform.length;idx++){const step=transform[idx];switch(step.type){case"find":rs.find(step.value);break;case"where":rs.where(step.value);break;case"simplesort":rs.simplesort(step.property,step.options);break;case"compoundsort":rs.compoundsort(step.value);break;case"sort":rs.sort(step.value);break;case"sortByScoring":rs.sortByScoring(step.desc);break;case"limit":rs=rs.limit(step.value);break;case"offset":rs=rs.offset(step.value);break;case"map":rs=rs.map(step.value,step.dataOptions);break;case"eqJoin":rs=rs.eqJoin(step.joinData,step.leftJoinKey,step.rightJoinKey,step.mapFun,step.dataOptions);break;case"mapReduce":rs=rs.mapReduce(step.mapFunction,step.reduceFunction);break;case"update":rs.update(step.value);break;case"remove":rs.remove()}}return rs}sort(comparefun){this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex());const data=this._collection._data;return this._filteredRows.sort((a,b)=>comparefun(data[a],data[b])),this}simplesort(propname,options={desc:!1}){if("boolean"==typeof options&&(options={desc:options}),!this._filterInitialized&&this._collection._rangedIndexes.hasOwnProperty(propname)){let sortedIds=this._collection._rangedIndexes[propname].index.rangeRequest(),dataPositions=[];for(let id of sortedIds)dataPositions.push(this._collection.get(id,!0)[1]);return this._filteredRows=options.desc?dataPositions.reverse():dataPositions,this._filterInitialized=!0,this}this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex());const data=this._collection._data;let comparator=options.sortComparator?comparators.a[options.sortComparator]:comparators.a[this._collection._unindexedSortComparator];return this._filteredRows.sort((a,b)=>comparator(data[a][propname],data[b][propname])),options.desc&&this._filteredRows.reverse(),this}compoundsort(properties){if(0===properties.length)throw new Error("Invalid call to compoundsort, need at least one property");if(1===properties.length){const prop=properties[0];return"string"==typeof prop?this.simplesort(prop,!1):this.simplesort(prop[0],prop[1])}for(let i=0,len=properties.length;i<len;i++){const prop=properties[i];"string"==typeof prop&&(properties[i]=[prop,!1])}this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex());const data=this._collection._data;return this._filteredRows.sort((a,b)=>this._compoundeval(properties,data[a],data[b])),this}_compoundeval(properties,obj1,obj2){for(let i=0,len=properties.length;i<len;i++){const prop=properties[i],field=prop[0],res=Object(operator_packages.d)(obj1[field],obj2[field],prop[1]);if(0!==res)return res}return 0}sortByScoring(ascending=!1){if(null===this._scoring)throw new Error("No scoring available");return ascending?this._filteredRows.sort((a,b)=>this._scoring[a].score-this._scoring[b].score):this._filteredRows.sort((a,b)=>this._scoring[b].score-this._scoring[a].score),this}getScoring(){if(null===this._scoring)throw new Error("No scoring available");const scoring=[];for(let i=0;i<this._filteredRows.length;i++)scoring.push(this._scoring[this._filteredRows[i]]);return scoring}findOr(expressionArray){const docset=[],idxset=[],origCount=this.count();for(let ei=0,elen=expressionArray.length;ei<elen;ei++){const fr=this.copy().find(expressionArray[ei])._filteredRows,frlen=fr.length;if(frlen===origCount)return this;for(let fri=0;fri<frlen;fri++){const idx=fr[fri];void 0===idxset[idx]&&(idxset[idx]=!0,docset.push(idx))}}return this._filteredRows=docset,this._filterInitialized=!0,this}$or(expressionArray){return this.findOr(expressionArray)}findAnd(expressionArray){for(let i=0,len=expressionArray.length;i<len;i++){if(0===this.count())return this;this.find(expressionArray[i])}return this}$and(expressionArray){return this.findAnd(expressionArray)}find(query,firstOnly=!1){if(0===this._collection._data.length)return this._filteredRows=[],this._filterInitialized=!0,this;const queryObject=query||"getAll";let property,queryObjectOp,value;if("object"==typeof queryObject){let filters=[];for(let p in queryObject){let obj={};obj[p]=queryObject[p],filters.push(obj),void 0!==queryObject[p]&&(property=p,queryObjectOp=queryObject[p])}if(filters.length>1)return this.find({$and:filters},firstOnly)}if(!property||"getAll"===queryObject)return firstOnly&&(this._filteredRows=this._collection._data.length>0?[0]:[],this._filterInitialized=!0),this;if("$and"===property||"$or"===property)return this[property](queryObjectOp),firstOnly&&this._filteredRows.length>1&&(this._filteredRows=this._filteredRows.slice(0,1)),this;let operator="";if(null===queryObjectOp||"object"!=typeof queryObjectOp||queryObjectOp instanceof Date)operator="$eq",value=queryObjectOp;else{if("object"!=typeof queryObjectOp)throw new Error("Do not know what you want to do.");for(let key in queryObjectOp)if(void 0!==queryObjectOp[key]){operator=key,value=queryObjectOp[key];break}}"$regex"===operator&&(Array.isArray(value)?value=new RegExp(value[0],value[1]):value instanceof RegExp||(value=new RegExp(value)));let searchByIndex=!1;!this._filterInitialized&&this._collection._rangedIndexes[property]&&indexedOps[operator]&&(searchByIndex=!0);const operatorPackage=operator_packages.a[this._collection._defaultLokiOperatorPackage],data=this._collection._data;let result=[];if(this._filterInitialized){let filter=this._filteredRows;if("$fts"===property){this._scoring=this._collection._fullTextSearch.search(queryObject.$fts);let keys=Object.keys(this._scoring);for(let i=0;i<keys.length;i++)-1!==filter.indexOf(+keys[i])&&result.push(+keys[i])}else if(void 0!==this._collection._constraints.unique[property]&&"$eq"===operator){const id=this._collection._constraints.unique[property].get(value);if(void 0!==id){const row=this._collection.get(id,!0)[1];-1!==filter.indexOf(row)&&result.push(row)}}else for(let i=0;i<filter.length;i++){let rowIdx=filter[i];operatorPackage[operator](data[rowIdx][property],value)&&result.push(rowIdx)}return this._filteredRows=result,this._filterInitialized=!0,this}if(this._filteredRows=result,this._filterInitialized=!0,"$fts"===property){this._scoring=this._collection._fullTextSearch.search(queryObject.$fts);let keys=Object.keys(this._scoring);for(let i=0;i<keys.length;i++)result.push(+keys[i]);return this}if(void 0!==this._collection._constraints.unique[property]&&"$eq"===operator){const id=this._collection._constraints.unique[property].get(value);return void 0!==id&&result.push(this._collection.get(id,!0)[1]),this}if(!searchByIndex){for(let i=0;i<data.length;i++)if(operatorPackage[operator](data[i][property],value)&&(result.push(i),firstOnly))return this;return this}if(this._collection._rangedIndexes[property]){if("$in"===operator){let ri=this._collection._rangedIndexes[property];for(let val of value){let idResult=ri.index.rangeRequest({op:"$eq",val:val});for(let id of idResult)result.push(this._collection.get(id,!0)[1])}return this}if("$between"===operator){let idResult=this._collection._rangedIndexes[property].index.rangeRequest({op:operator,val:value[0],high:value[1]});for(let id of idResult)result.push(this._collection.get(id,!0)[1]);return this}let idResult=this._collection._rangedIndexes[property].index.rangeRequest({op:operator,val:value});if(!0!==indexedOps[operator])for(let id of idResult){let pos=this._collection.get(id,!0)[1];indexedOps[operator](data[pos][property],value)&&result.push(pos)}else for(let id of idResult)result.push(this._collection.get(id,!0)[1])}return this}where(fun){let viewFunction,result=[];if("function"!=typeof fun)throw new TypeError("Argument is not a stored view or a function");if(viewFunction=fun,this._filterInitialized){let j=this._filteredRows.length;for(;j--;)!0===viewFunction(this._collection._data[this._filteredRows[j]])&&result.push(this._filteredRows[j]);return this._filteredRows=result,this}{let k=this._collection._data.length;for(;k--;)!0===viewFunction(this._collection._data[k])&&result.push(k);return this._filteredRows=result,this._filterInitialized=!0,this}}count(){return this._filterInitialized?this._filteredRows.length:this._collection.count()}data(options={}){let forceClones,forceCloneMethod,removeMeta;({forceClones:forceClones=!1,forceCloneMethod:forceCloneMethod=this._collection._cloneMethod,removeMeta:removeMeta=!1}=options);let obj,method,result=[],data=this._collection._data;if(removeMeta&&!forceClones&&(forceClones=!0,forceCloneMethod="shallow"),this._collection._disableDeltaChangesApi||(forceClones=!0,forceCloneMethod="deep"),!this._filterInitialized){if(0===this._filteredRows.length){if(this._collection._cloneObjects||forceClones){method=forceCloneMethod;for(let i=0;i<data.length;i++)obj=this._collection._defineNestedProperties(clone(data[i],method)),removeMeta&&(delete obj.$loki,delete obj.meta),result.push(obj);return result}return data.slice()}this._filterInitialized=!0}const fr=this._filteredRows;if(this._collection._cloneObjects||forceClones){method=forceCloneMethod;for(let i=0;i<fr.length;i++)obj=this._collection._defineNestedProperties(clone(data[fr[i]],method)),removeMeta&&(delete obj.$loki,delete obj.meta),result.push(obj)}else for(let i=0;i<fr.length;i++)result.push(data[fr[i]]);return result}update(updateFunction){this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex());const len=this._filteredRows.length,rcd=this._collection._data;for(let idx=0;idx<len;idx++)if(this._collection._cloneObjects||!this._collection._disableDeltaChangesApi){const obj=clone(rcd[this._filteredRows[idx]],this._collection._cloneMethod);updateFunction(obj),this._collection.update(obj)}else updateFunction(rcd[this._filteredRows[idx]]),this._collection.update(rcd[this._filteredRows[idx]]);return this}remove(){return this._filterInitialized||0!==this._filteredRows.length||(this._filteredRows=this._collection._prepareFullDocIndex()),this._collection.remove(this.data()),this._filteredRows=[],this}mapReduce(mapFunction,reduceFunction){try{return reduceFunction(this.data().map(mapFunction))}catch(err){throw err}}eqJoin(joinData,leftJoinKey,rightJoinKey,mapFun,dataOptions){let rightDataLength,key,rightData=[],result=[],leftKeyisFunction="function"==typeof leftJoinKey,rightKeyisFunction="function"==typeof rightJoinKey,joinMap={},leftData=this.data(dataOptions),leftDataLength=leftData.length;if(joinData instanceof collection_Collection)rightData=joinData.chain().data(dataOptions);else if(joinData instanceof result_set_ResultSet)rightData=joinData.data(dataOptions);else{if(!Array.isArray(joinData))throw new TypeError("joinData needs to be an array or result set");rightData=joinData}rightDataLength=rightData.length;for(let i=0;i<rightDataLength;i++)key=rightKeyisFunction?rightJoinKey(rightData[i]):rightData[i][rightJoinKey],joinMap[key]=rightData[i];mapFun||(mapFun=(left,right)=>({left:left,right:right}));for(let j=0;j<leftDataLength;j++)key=leftKeyisFunction?leftJoinKey(leftData[j]):leftData[j][leftJoinKey],result.push(mapFun(leftData[j],joinMap[key]||{}));return this._collection=new collection_Collection("joinData"),this._collection.insert(result),this._filteredRows=[],this._filterInitialized=!1,this}map(mapFun,dataOptions){const data=this.data(dataOptions).map(mapFun);return this._collection=new collection_Collection("mappedData"),this._collection.insert(data),this._filteredRows=[],this._filterInitialized=!1,this}}class dynamic_view_DynamicView extends event_emitter.a{constructor(collection,name,options={}){super(),this._rebuildPending=!1,this._resultData=[],this._resultDirty=!1,this._cachedResultSet=null,this._filterPipeline=[],this._sortFunction=null,this._sortCriteria=null,this._sortCriteriaSimple=null,this._sortByScoring=null,this._sortDirty=!1,({persistent:this._persistent=!1,sortPriority:this._sortPriority="passive",minRebuildInterval:this._minRebuildInterval=1}=options),this._collection=collection,this.name=name,this._resultSet=new result_set_ResultSet(collection),this._events={rebuild:[]}}_rematerialize({removeWhereFilters:removeWhereFilters=!1}){if(this._resultData=[],this._resultDirty=!0,this._resultSet=new result_set_ResultSet(this._collection),(this._sortFunction||this._sortCriteria||this._sortCriteriaSimple||null!==this._sortByScoring)&&(this._sortDirty=!0),removeWhereFilters){let fpi=this._filterPipeline.length;for(;fpi--;)"where"===this._filterPipeline[fpi].type&&(fpi!==this._filterPipeline.length-1&&(this._filterPipeline[fpi]=this._filterPipeline[this._filterPipeline.length-1]),this._filterPipeline.length--)}const ofp=this._filterPipeline;this._filterPipeline=[];for(let idx=0;idx<ofp.length;idx++)this.applyFind(ofp[idx].val);return this.data(),this.emit("rebuild",this),this}branchResultSet(transform,parameters){const rs=this._resultSet.copy();return void 0===transform?rs:rs.transform(transform,parameters)}toJSON(){return{name:this.name,_persistent:this._persistent,_sortPriority:this._sortPriority,_minRebuildInterval:this._minRebuildInterval,_resultSet:this._resultSet,_filterPipeline:this._filterPipeline,_sortCriteria:this._sortCriteria,_sortCriteriaSimple:this._sortCriteriaSimple,_sortByScoring:this._sortByScoring,_sortDirty:this._sortDirty}}static fromJSONObject(collection,obj){let dv=new dynamic_view_DynamicView(collection,obj.name);return dv._resultDirty=!0,dv._filterPipeline=obj._filterPipeline,dv._resultData=[],dv._sortCriteria=obj._sortCriteria,dv._sortCriteriaSimple=obj._sortCriteriaSimple,dv._sortByScoring=obj._sortByScoring,dv._sortDirty=obj._sortDirty,dv._resultSet._filteredRows=obj._resultSet._filteredRows,dv._resultSet._filterInitialized=obj._resultSet._filterInitialized,dv._rematerialize({removeWhereFilters:!0}),dv}removeFilters({queueSortPhase:queueSortPhase=!1}={}){this._rebuildPending=!1,this._resultSet.reset(),this._resultData=[],this._resultDirty=!0,this._cachedResultSet=null,this._filterPipeline=[],this._sortFunction=null,this._sortCriteria=null,this._sortCriteriaSimple=null,this._sortByScoring=null,this._sortDirty=!1,!0===queueSortPhase&&this._queueSortPhase()}applySort(comparefun){return this._sortFunction=comparefun,this._sortCriteria=null,this._sortCriteriaSimple=null,this._sortByScoring=null,this._queueSortPhase(),this}applySimpleSort(field,options=!1){return this._sortCriteriaSimple={field:field,options:options},this._sortFunction=null,this._sortCriteria=null,this._sortByScoring=null,this._queueSortPhase(),this}applySortCriteria(criteria){return this._sortCriteria=criteria,this._sortCriteriaSimple=null,this._sortFunction=null,this._sortByScoring=null,this._queueSortPhase(),this}applySortByScoring(ascending=!1){return this._sortFunction=null,this._sortCriteria=null,this._sortCriteriaSimple=null,this._sortByScoring=ascending,this._queueSortPhase(),this}getScoring(){return this._resultSet.getScoring()}startTransaction(){return this._cachedResultSet=this._resultSet.copy(),this}commit(){return this._cachedResultSet=null,this}rollback(){return this._resultSet=this._cachedResultSet,this._persistent&&(this._resultData=this._resultSet.data(),this.emit("rebuild",this)),this}_indexOfFilterWithId(uid){if("string"==typeof uid||"number"==typeof uid)for(let idx=0,len=this._filterPipeline.length;idx<len;idx++)if(uid===this._filterPipeline[idx].uid)return idx;return-1}_addFilter(filter){this._filterPipeline.push(filter),this._resultSet[filter.type](filter.val)}reapplyFilters(){this._resultSet.reset(),this._cachedResultSet=null,this._persistent&&(this._resultData=[],this._resultDirty=!0);const filters=this._filterPipeline;this._filterPipeline=[];for(let idx=0,len=filters.length;idx<len;idx++)this._addFilter(filters[idx]);return this._sortFunction||this._sortCriteria||this._sortCriteriaSimple||null!==this._sortByScoring?this._queueSortPhase():this._queueRebuildEvent(),this}applyFilter(filter){const idx=this._indexOfFilterWithId(filter.uid);return idx>=0?(this._filterPipeline[idx]=filter,this.reapplyFilters()):(this._cachedResultSet=null,this._persistent&&(this._resultData=[],this._resultDirty=!0),this._addFilter(filter),this._sortFunction||this._sortCriteria||this._sortCriteriaSimple||null!==this._sortByScoring?this._queueSortPhase():this._queueRebuildEvent(),this)}applyFind(query,uid=""){return this.applyFilter({type:"find",val:query,uid:uid}),this}applyWhere(fun,uid){return this.applyFilter({type:"where",val:fun,uid:uid}),this}removeFilter(uid){const idx=this._indexOfFilterWithId(uid);if(idx<0)throw new Error("Dynamic view does not contain a filter with ID: "+uid);return this._filterPipeline.splice(idx,1),this.reapplyFilters(),this}count(){return this._resultDirty&&(this._resultData=this._resultSet.data()),this._resultSet.count()}data(options={}){return(this._sortDirty||this._resultDirty)&&this._performSortPhase({suppressRebuildEvent:!0}),this._persistent?this._resultData:this._resultSet.data(options)}_queueRebuildEvent(){this._rebuildPending||(this._rebuildPending=!0,setTimeout(()=>{this._rebuildPending&&(this._rebuildPending=!1,this.emit("rebuild",this))},this._minRebuildInterval))}_queueSortPhase(){this._sortDirty||(this._sortDirty=!0,"active"===this._sortPriority?setTimeout(()=>{this._performSortPhase()},this._minRebuildInterval):this._queueRebuildEvent())}_performSortPhase(options={}){(this._sortDirty||this._resultDirty)&&(this._sortDirty&&(this._sortFunction?this._resultSet.sort(this._sortFunction):this._sortCriteria?this._resultSet.compoundsort(this._sortCriteria):this._sortCriteriaSimple?this._resultSet.simplesort(this._sortCriteriaSimple.field,this._sortCriteriaSimple.options):null!==this._sortByScoring&&this._resultSet.sortByScoring(this._sortByScoring),this._sortDirty=!1),this._persistent&&(this._resultData=this._resultSet.data(),this._resultDirty=!1),options.suppressRebuildEvent||this.emit("rebuild",this))}_evaluateDocument(objIndex,isNew){if(!this._resultSet._filterInitialized)return this._persistent&&(this._resultData=this._resultSet.data()),void(this._sortFunction||this._sortCriteria||this._sortCriteriaSimple?this._queueSortPhase():this._queueRebuildEvent());const ofr=this._resultSet._filteredRows,oldPos=isNew?-1:ofr.indexOf(+objIndex),oldlen=ofr.length,evalResultSet=new result_set_ResultSet(this._collection);let filter;evalResultSet._filteredRows=[objIndex],evalResultSet._filterInitialized=!0;for(let idx=0,len=this._filterPipeline.length;idx<len;idx++)filter=this._filterPipeline[idx],evalResultSet[filter.type](filter.val);const newPos=0===evalResultSet._filteredRows.length?-1:0;return-1!==oldPos||-1!==newPos?-1===oldPos&&-1!==newPos?(ofr.push(objIndex),this._persistent&&this._resultData.push(this._collection._data[objIndex]),void(this._sortFunction||this._sortCriteria||this._sortCriteriaSimple?this._queueSortPhase():this._queueRebuildEvent())):-1!==oldPos&&-1===newPos?(oldPos<oldlen-1?(ofr.splice(oldPos,1),this._persistent&&this._resultData.splice(oldPos,1)):(ofr.length=oldlen-1,this._persistent&&(this._resultData.length=oldlen-1)),void(this._sortFunction||this._sortCriteria||this._sortCriteriaSimple?this._queueSortPhase():this._queueRebuildEvent())):void(-1!==oldPos&&-1!==newPos&&(this._persistent&&(this._resultData[oldPos]=this._collection._data[objIndex]),this._sortFunction||this._sortCriteria||this._sortCriteriaSimple?this._queueSortPhase():this._queueRebuildEvent())):void 0}_removeDocument(objIndex){if(!this._resultSet._filterInitialized)return this._persistent&&(this._resultData=this._resultSet.data()),void(this._sortFunction||this._sortCriteria||this._sortCriteriaSimple?this._queueSortPhase():this._queueRebuildEvent());const ofr=this._resultSet._filteredRows,oldPos=ofr.indexOf(+objIndex);let oldlen=ofr.length;-1!==oldPos&&(oldPos<oldlen-1?(ofr[oldPos]=ofr[oldlen-1],ofr.length=oldlen-1,this._persistent&&(this._resultData[oldPos]=this._resultData[oldlen-1],this._resultData.length=oldlen-1)):(ofr.length=oldlen-1,this._persistent&&(this._resultData.length=oldlen-1)),this._sortFunction||this._sortCriteria||this._sortCriteriaSimple?this._queueSortPhase():this._queueRebuildEvent()),oldlen=ofr.length;for(let idx=0;idx<oldlen;idx++)ofr[idx]>objIndex&&ofr[idx]--}mapReduce(mapFunction,reduceFunction){try{return reduceFunction(this.data().map(mapFunction))}catch(err){throw err}}}var ranged_indexes=__webpack_require__(4),common_plugin=__webpack_require__(1);function average(array){return array.reduce((a,b)=>a+b,0)/array.length}function getNestedPropertyValue(obj,path,array,pathIdx=0){if(void 0===obj)return!1;if(pathIdx+1===path.length)return array.push(obj[path[pathIdx]]),!1;const curr=obj[path[pathIdx]];if(Array.isArray(curr)){for(let i=0;i<curr.length;i++)getNestedPropertyValue(curr[i],path,array,pathIdx+1);return!0}return getNestedPropertyValue(curr,path,array,pathIdx+1)}__webpack_require__.d(__webpack_exports__,"a",(function(){return collection_Collection}));class collection_Collection extends event_emitter.a{constructor(name,options={}){if(super(),this._data=[],this._idIndex=[],this._rangedIndexes={},this._lokimap={},this._unindexedSortComparator="js",this._defaultLokiOperatorPackage="js",this._constraints={unique:{}},this._transforms={},this._dirty=!0,this._cached=null,this._nestedProperties=[],this._ttl={age:null,ttlInterval:null,daemon:null},this._maxId=0,this._dynamicViews=[],this._changes=[],this._stages={},this._commitLog=[],options&&!0===options.disableMeta){if(!1===options.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===options.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof options.ttl&&options.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}if(this.name=name,this._unindexedSortComparator=options.unindexedSortComparator||"js",this._defaultLokiOperatorPackage=options.defaultLokiOperatorPackage||"js",void 0!==options.unique&&(Array.isArray(options.unique)||(options.unique=[options.unique]),options.unique.forEach(prop=>{this._constraints.unique[prop]=new UniqueIndex(prop)})),void 0!==common_plugin.a.FullTextSearch?this._fullTextSearch=void 0!==options.fullTextSearch?new common_plugin.a.FullTextSearch(options.fullTextSearch):null:this._fullTextSearch=null,this._transactional=void 0!==options.transactional&&options.transactional,this._cloneObjects=void 0!==options.clone&&options.clone,this._asyncListeners=void 0!==options.asyncListeners&&options.asyncListeners,this._disableMeta=void 0!==options.disableMeta&&options.disableMeta,this._disableChangesApi=void 0===options.disableChangesApi||options.disableChangesApi,this._disableDeltaChangesApi=void 0===options.disableDeltaChangesApi||options.disableDeltaChangesApi,this._cloneMethod=void 0!==options.cloneMethod?options.cloneMethod:"deep",this._disableChangesApi&&(this._disableDeltaChangesApi=!0),this._serializableIndexes=void 0===options.serializableIndexes||options.serializableIndexes,null!=options.nestedProperties)for(let i=0;i<options.nestedProperties.length;i++){const nestedProperty=options.nestedProperties[i];"string"==typeof nestedProperty?this._nestedProperties.push({name:nestedProperty,path:nestedProperty.split(".")}):this._nestedProperties.push(nestedProperty)}this.setTTL(options.ttl||-1,options.ttlInterval),this._events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this._ensureId();let rangedIndexes=options.rangedIndexes||{};for(let ri in rangedIndexes)this.ensureRangedIndex(ri,rangedIndexes[ri].indexTypeName,rangedIndexes[ri].comparatorName);this.setChangesApi(this._disableChangesApi,this._disableDeltaChangesApi),this.flushChanges()}toJSON(){return{name:this.name,unindexedSortComparator:this._unindexedSortComparator,defaultLokiOperatorPackage:this._defaultLokiOperatorPackage,_dynamicViews:this._dynamicViews,uniqueNames:Object.keys(this._constraints.unique),transforms:this._transforms,rangedIndexes:this._rangedIndexes,_data:this._data,idIndex:this._idIndex,maxId:this._maxId,_dirty:this._dirty,_nestedProperties:this._nestedProperties,transactional:this._transactional,asyncListeners:this._asyncListeners,disableMeta:this._disableMeta,disableChangesApi:this._disableChangesApi,disableDeltaChangesApi:this._disableDeltaChangesApi,cloneObjects:this._cloneObjects,cloneMethod:this._cloneMethod,changes:this._changes,_fullTextSearch:this._fullTextSearch}}static fromJSONObject(obj,options){let coll=new collection_Collection(obj.name,{disableChangesApi:obj.disableChangesApi,disableDeltaChangesApi:obj.disableDeltaChangesApi,unindexedSortComparator:obj.unindexedSortComparator,defaultLokiOperatorPackage:obj.defaultLokiOperatorPackage});if(coll._transactional=obj.transactional,coll._asyncListeners=obj.asyncListeners,coll._disableMeta=obj.disableMeta,coll._disableChangesApi=obj.disableChangesApi,coll._cloneObjects=obj.cloneObjects,coll._cloneMethod=obj.cloneMethod||"deep",coll._changes=obj.changes,coll._nestedProperties=obj._nestedProperties,coll._rangedIndexes=obj.rangedIndexes||{},coll._dirty=!(!options||!0!==options.retainDirtyFlags)&&obj._dirty,options&&void 0!==options[obj.name]){let loader=function makeLoader(coll){const collOptions=options[coll.name];if(collOptions.proto){const inflater=collOptions.inflate||((src,dest)=>{for(let prop in src)dest[prop]=src[prop]});return data=>{const collObj=new collOptions.proto;return inflater(data,collObj),collObj}}return collOptions.inflate}(obj);for(let j=0;j<obj._data.length;j++)coll._data[j]=coll._defineNestedProperties(loader(obj._data[j])),coll._lokimap[coll._data[j].$loki]=coll._data[j]}else for(let j=0;j<obj._data.length;j++)coll._data[j]=coll._defineNestedProperties(obj._data[j]),coll._lokimap[coll._data[j].$loki]=coll._data[j];coll._maxId=void 0===obj.maxId?0:obj.maxId,coll._idIndex=obj.idIndex,void 0!==obj.transforms&&(coll._transforms=obj.transforms);for(let ri in obj.rangedIndexes){let sri=obj.rangedIndexes[ri],rii=(0,ranged_indexes.a[sri.indexTypeName])(ri,comparators.a[sri.comparatorName]);rii.restore(sri.index),coll._rangedIndexes[ri].index=rii}if(coll._ensureId(),void 0!==obj.uniqueNames)for(let j=0;j<obj.uniqueNames.length;j++)coll.ensureUniqueIndex(obj.uniqueNames[j]);if(void 0!==obj._dynamicViews)for(let idx=0;idx<obj._dynamicViews.length;idx++)coll._dynamicViews.push(dynamic_view_DynamicView.fromJSONObject(coll,obj._dynamicViews[idx]));return obj._fullTextSearch&&(coll._fullTextSearch=common_plugin.a.FullTextSearch.fromJSONObject(obj._fullTextSearch,options.fullTextSearch)),coll}addTransform(name,transform){if(void 0!==this._transforms[name])throw new Error("a transform by that name already exists");this._transforms[name]=transform}getTransform(name){return this._transforms[name]}setTransform(name,transform){this._transforms[name]=transform}removeTransform(name){delete this._transforms[name]}setTTL(age,interval){age<0?clearInterval(this._ttl.daemon):(this._ttl.age=age,this._ttl.ttlInterval=interval,this._ttl.daemon=setInterval(()=>{const now=Date.now();this.chain().where(member=>{const timestamp=member.meta.updated||member.meta.created,diff=now-timestamp;return this._ttl.age<diff}).remove()},interval))}_prepareFullDocIndex(){const indexes=new Array(this._data.length);for(let i=0;i<indexes.length;i++)indexes[i]=i;return indexes}ensureIndex(field,indexTypeName,comparatorName){this.ensureRangedIndex(field,indexTypeName,comparatorName)}ensureRangedIndex(field,indexTypeName,comparatorName){if(indexTypeName=indexTypeName||"avl",comparatorName=comparatorName||"loki",!ranged_indexes.a[indexTypeName])throw new Error("ensureRangedIndex: Unknown range index type");if(!comparators.a[comparatorName])throw new Error("ensureRangedIndex: Unknown comparator");let rif=ranged_indexes.a[indexTypeName],comparator=comparators.a[comparatorName];this._rangedIndexes[field]={index:rif(field,comparator),indexTypeName:indexTypeName,comparatorName:comparatorName};let rii=this._rangedIndexes[field].index;for(let i=0;i<this._data.length;i++)rii.insert(this._data[i].$loki,this._data[i][field])}ensureUniqueIndex(field){let index=new UniqueIndex(field);this._constraints.unique[field]=index;for(let i=0;i<this._data.length;i++)index.set(this._data[i].$loki,this._data[i][field]);return index}count(query){return query?this.chain().find(query)._filteredRows.length:this._data.length}_ensureId(){this._idIndex=[];for(let i=0;i<this._data.length;i++)this._idIndex.push(this._data[i].$loki)}addDynamicView(name,options){const dv=new dynamic_view_DynamicView(this,name,options);return this._dynamicViews.push(dv),dv}removeDynamicView(name){for(let idx=0;idx<this._dynamicViews.length;idx++)this._dynamicViews[idx].name===name&&this._dynamicViews.splice(idx,1)}getDynamicView(name){for(let idx=0;idx<this._dynamicViews.length;idx++)if(this._dynamicViews[idx].name===name)return this._dynamicViews[idx];return null}findAndUpdate(filterObject,updateFunction){this.chain().find(filterObject).update(updateFunction)}findAndRemove(filterObject){this.chain().find(filterObject).remove()}insert(doc){if(!Array.isArray(doc))return this.insertOne(doc);let obj,results=[];this.emit("pre-insert",doc);for(let i=0;i<doc.length;i++){if(obj=this.insertOne(doc[i],!0),!obj)return;results.push(obj)}return this.emit("insert",results),results=this._cloneObjects?clone(results,this._cloneMethod):results,1===results.length?results[0]:results}insertOne(doc,bulkInsert=!1){let returnObj,err=null;if("object"!=typeof doc?err=new TypeError("Document needs to be an object"):null===doc&&(err=new TypeError("Object cannot be null")),null!==err)throw this.emit("error",err),err;const obj=this._defineNestedProperties(this._cloneObjects?clone(doc,this._cloneMethod):doc);if(this._disableMeta||void 0!==obj.meta||(obj.meta={version:0,revision:0,created:0}),bulkInsert||this.emit("pre-insert",obj),this._add(obj))return this._disableChangesApi?this._insertMeta(obj):this._insertMetaWithChange(obj),returnObj=this._cloneObjects?clone(obj,this._cloneMethod):obj,bulkInsert||this.emit("insert",returnObj),returnObj}_defineNestedProperties(data){for(let i=0;i<this._nestedProperties.length;i++){const name=this._nestedProperties[i].name,path=this._nestedProperties[i].path;Object.defineProperty(data,name,{get(){const array=[];return getNestedPropertyValue(this,path,array)?array:array[0]},set(val){path.slice(0,path.length-1).reduce((obj,part)=>obj&&obj[part]?obj[part]:null,this)[path[path.length-1]]=val},enumerable:!1,configurable:!0})}return data}clear({removeIndices:removeIndices=!1}={}){if(this._data=[],this._idIndex=[],this._cached=null,this._maxId=0,this._dynamicViews=[],this._dirty=!0,!0===removeIndices)this._rangedIndexes={},this._constraints={unique:{}};else{for(let ri in this._rangedIndexes)this.ensureRangedIndex(ri,this._rangedIndexes[ri].indexTypeName,this._rangedIndexes[ri].comparatorName);const uniqueNames=Object.keys(this._constraints.unique);for(let i=0;i<uniqueNames.length;i++)this._constraints.unique[uniqueNames[i]].clear()}null!==this._fullTextSearch&&this._fullTextSearch.clear()}update(doc){if(Array.isArray(doc))for(let i=0;i<doc.length;i++)this.update(doc[i]);else{if(void 0===doc.$loki)throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();const arr=this.get(doc.$loki,!0);if(!arr)throw new Error("Trying to update a document not in collection.");let oldInternal=arr[0],position=arr[1],newInternal=this._defineNestedProperties(this._cloneObjects||!this._disableDeltaChangesApi?clone(doc,this._cloneMethod):doc);this.emit("pre-update",doc),Object.keys(this._constraints.unique).forEach(key=>{this._constraints.unique[key].update(newInternal.$loki,newInternal[key])}),this._data[position]=newInternal,this._lokimap[doc.$loki]=newInternal;for(let idx=0;idx<this._dynamicViews.length;idx++)this._dynamicViews[idx]._evaluateDocument(position,!1);for(let ri in this._rangedIndexes)this._rangedIndexes[ri].index.update(doc.$loki,doc[ri]);this._idIndex[position]=newInternal.$loki,null!==this._fullTextSearch&&this._fullTextSearch.updateDocument(doc,position),this.commit(),this._dirty=!0,this._disableChangesApi?this._updateMeta(newInternal):this._updateMetaWithChange(newInternal,oldInternal);let returnObj=newInternal;this._cloneObjects&&(returnObj=clone(newInternal,this._cloneMethod)),this.emit("update",returnObj,oldInternal)}catch(err){throw this.rollback(),this.emit("error",err),err}}}_add(obj){if("object"!=typeof obj)throw new TypeError("Object being added needs to be an object");if(void 0!==obj.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this._maxId++,isNaN(this._maxId)&&(this._maxId=this._data[this._data.length-1].$loki+1);const newDoc=obj;newDoc.$loki=this._maxId,this._disableMeta||(newDoc.meta.version=0);const constrUnique=this._constraints.unique;for(const key in constrUnique)void 0!==constrUnique[key]&&constrUnique[key].set(newDoc.$loki,newDoc[key]);this._idIndex.push(newDoc.$loki),this._lokimap[newDoc.$loki]=newDoc,this._data.push(newDoc);const addedPos=this._data.length-1,dvlen=this._dynamicViews.length;for(let i=0;i<dvlen;i++)this._dynamicViews[i]._evaluateDocument(addedPos,!0);for(let ri in this._rangedIndexes)this._serializableIndexes&&newDoc[ri]instanceof Date&&(newDoc[ri]=newDoc[ri].getTime()),this._rangedIndexes[ri].index.insert(obj.$loki,obj[ri]);return null!==this._fullTextSearch&&this._fullTextSearch.addDocument(newDoc,addedPos),this.commit(),this._dirty=!0,this._cloneObjects?clone(newDoc,this._cloneMethod):newDoc}catch(err){throw this.rollback(),this.emit("error",err),err}}updateWhere(filterFunction,updateFunction){const results=this.where(filterFunction);try{for(let i=0;i<results.length;i++)this.update(updateFunction(results[i]))}catch(err){throw this.rollback(),err}}removeWhere(filterFunction){this.remove(this._data.filter(filterFunction))}removeDataOnly(){this.remove(this._data.slice())}remove(doc){if("number"==typeof doc&&(doc=this.get(doc)),Array.isArray(doc)){let k=0;const len=doc.length;for(;k<len;k++)this.remove(doc[k])}else{if(void 0===doc.$loki)throw new Error("Object is not a document stored in the collection");try{this.startTransaction();const arr=this.get(doc.$loki,!0),position=arr[1];let aDoc="number"==typeof doc?this.get(doc):doc;Object.keys(this._constraints.unique).forEach(key=>{key in aDoc&&this._constraints.unique[key].remove(aDoc.$loki)});for(let idx=0;idx<this._dynamicViews.length;idx++)this._dynamicViews[idx]._removeDocument(position);this._data.splice(position,1),this._idIndex.splice(position,1),delete this._lokimap[doc.$loki];for(let ri in this._rangedIndexes)this._rangedIndexes[ri].index.remove(doc.$loki);null!==this._fullTextSearch&&this._fullTextSearch.removeDocument(doc,position),this.commit(),this._dirty=!0,this._disableChangesApi||this._createChange(this.name,"R",arr[0]),this.emit("delete",arr[0]),delete doc.$loki,delete doc.meta}catch(err){throw this.rollback(),this.emit("error",err),err}}}getChanges(){return this._changes}setChangesApi(disableChangesApi,disableDeltaChangesApi=!0){this._disableChangesApi=disableChangesApi,this._disableDeltaChangesApi=!!disableChangesApi||disableDeltaChangesApi}flushChanges(){this._changes=[]}_getObjectDelta(oldObject,newObject){const propertyNames=null!==newObject&&"object"==typeof newObject?Object.keys(newObject):null;if(propertyNames&&propertyNames.length&&["string","boolean","number"].indexOf(typeof newObject)<0){const delta={};for(let i=0;i<propertyNames.length;i++){const propertyName=propertyNames[i];if(newObject.hasOwnProperty(propertyName))if(oldObject.hasOwnProperty(propertyName)&&void 0===this._constraints.unique[propertyName]&&"$loki"!==propertyName&&"meta"!==propertyName){const propertyDelta=this._getObjectDelta(oldObject[propertyName],newObject[propertyName]);void 0!==propertyDelta&&propertyDelta!=={}&&(delta[propertyName]=propertyDelta)}else delta[propertyName]=newObject[propertyName]}return 0===Object.keys(delta).length?void 0:delta}return oldObject===newObject?void 0:newObject}_getChangeDelta(obj,old){return old?this._getObjectDelta(old,obj):JSON.parse(JSON.stringify(obj))}_createChange(name,op,obj,old){this._changes.push({name:name,operation:op,obj:"U"!==op||this._disableDeltaChangesApi?JSON.parse(JSON.stringify(obj)):this._getChangeDelta(obj,old)})}_createInsertChange(obj){this._createChange(this.name,"I",obj)}_createUpdateChange(obj,old){this._createChange(this.name,"U",obj,old)}_insertMetaWithChange(obj){this._insertMeta(obj),this._createInsertChange(obj)}_updateMetaWithChange(obj,old){this._updateMeta(obj),this._createUpdateChange(obj,old)}_insertMeta(obj){this._disableMeta||(obj.meta||(obj.meta={version:0,revision:0,created:0}),obj.meta.created=(new Date).getTime(),obj.meta.revision=0)}_updateMeta(obj){this._disableMeta||(obj.meta.updated=(new Date).getTime(),obj.meta.revision+=1)}get(id,returnPosition=!1){if(!returnPosition){let doc=this._lokimap[id];return void 0===doc?null:doc}const data=this._idIndex;let max=data.length-1,min=0,mid=min+max>>1;if(id="number"==typeof id?id:parseInt(id,10),isNaN(id))throw new TypeError("Passed id is not an integer");for(;data[min]<data[max];)mid=min+max>>1,data[mid]<id?min=mid+1:max=mid;return max===min&&data[min]===id?returnPosition?[this._data[min],min]:this._data[min]:null}by(field,value){let lokiId=this._constraints.unique[field].get(value);return this._cloneObjects?clone(this._lokimap[lokiId],this._cloneMethod):this._lokimap[lokiId]}findOne(query){query=query||{};const result=this.chain().find(query,!0).data();return Array.isArray(result)&&0===result.length?null:this._cloneObjects?clone(result[0],this._cloneMethod):result[0]}chain(transform,parameters){const rs=new result_set_ResultSet(this);return void 0===transform?rs:rs.transform(transform,parameters)}find(query){return this.chain().find(query).data()}findOneUnindexed(prop,value){let doc,i=this._data.length;for(;i--;)if(this._data[i][prop]===value)return doc=this._data[i],doc;return null}startTransaction(){if(this._transactional){let rib={};for(let ri in this._rangedIndexes)rib[ri].indexTypeName=this._rangedIndexes[ri].indexTypeName,rib[ri].comparatorName=this._rangedIndexes[ri].comparatorName,rib[ri].index=this._rangedIndexes[ri].index.backup();this._cached={index:this._idIndex,data:clone(this._data,this._cloneMethod),rangedIndexes:rib};for(let idx=0;idx<this._dynamicViews.length;idx++)this._dynamicViews[idx].startTransaction()}}commit(){if(this._transactional){this._cached=null;for(let idx=0;idx<this._dynamicViews.length;idx++)this._dynamicViews[idx].commit()}}rollback(){if(this._transactional&&null!==this._cached){this._idIndex=this._cached.index,this._data=this._cached.data;for(let i=0;i<this._data.length;i++)this._data[i]=this._defineNestedProperties(this._data[i]);for(let ri in this._cached.rangedIndexes){let sri=this._cached.rangedIndexes[ri],rii=(0,ranged_indexes.a[sri.indexTypeName])(ri,comparators.a[sri.comparatorName]);rii.restore(sri.index),this._rangedIndexes[ri].index=rii}for(let idx=0;idx<this._dynamicViews.length;idx++)this._dynamicViews[idx].rollback()}}where(fun){return this.chain().where(fun).data()}mapReduce(mapFunction,reduceFunction){return reduceFunction(this._data.map(mapFunction))}eqJoin(joinData,leftJoinProp,rightJoinProp,mapFun,dataOptions){return new result_set_ResultSet(this).eqJoin(joinData,leftJoinProp,rightJoinProp,mapFun,dataOptions)}getStage(name){return this._stages[name]||(this._stages[name]={}),this._stages[name]}stage(stageName,obj){const copy=JSON.parse(JSON.stringify(obj));return this.getStage(stageName)[obj.$loki]=copy,copy}commitStage(stageName,message){const stage=this.getStage(stageName),timestamp=(new Date).getTime();for(const prop in stage)this.update(stage[prop]),this._commitLog.push({timestamp:timestamp,message:message,data:JSON.parse(JSON.stringify(stage[prop]))});this._stages[stageName]={}}extract(field){const result=[];for(let i=0;i<this._data.length;i++)result.push(this._data[i][field]);return result}min(field){return Math.min.apply(null,this.extractNumerical(field))}max(field){return Math.max.apply(null,this.extractNumerical(field))}minRecord(field){const result={index:0,value:0};if(0===this._data.length)return result.index=null,result.value=null,result;result.index=this._data[0].$loki,result.value=parseFloat(this._data[0][field]);for(let i=1;i<this._data.length;i++){const val=parseFloat(this._data[i][field]);result.value>val&&(result.value=val,result.index=this._data[i].$loki)}return result}maxRecord(field){const result={index:0,value:0};if(0===this._data.length)return result.index=null,result.value=null,result;result.index=this._data[0].$loki,result.value=parseFloat(this._data[0][field]);for(let i=1;i<this._data.length;i++){const val=parseFloat(this._data[i][field]);result.value<val&&(result.value=val,result.index=this._data[i].$loki)}return result}extractNumerical(field){return this.extract(field).map(parseFloat).filter(Number).filter(n=>!isNaN(n))}avg(field){return average(this.extractNumerical(field))}stdDev(field){return function standardDeviation(values){const avg=average(values),avgSquareDiff=average(values.map(value=>{const diff=value-avg;return diff*diff}));return Math.sqrt(avgSquareDiff)}(this.extractNumerical(field))}mode(field){const dict={},data=this.extractNumerical(field);let mode=data[0],maxCount=-1/0;for(let i=0;i<data.length;i++){const el=data[i];dict[el]?dict[el]++:dict[el]=1,dict[el]>maxCount&&(mode=el,maxCount=dict[el])}return mode}median(field){const values=this.extractNumerical(field);values.sort((a,b)=>a-b);const half=Math.floor(values.length/2);return values.length%2?values[half]:(values[half-1]+values[half])/2}}},function(module,__webpack_exports__,__webpack_require__){"use strict";class AvlTreeIndex{constructor(name,comparator){this.nodes={},this.apex=null,this.name=name,this.comparator=comparator}backup(){let result=new AvlTreeIndex(this.name,this.comparator);return result.nodes=JSON.parse(JSON.stringify(this.nodes)),result.apex=this.apex,result}restore(tree){this.name=tree.name,this.comparator=tree.comparator,this.nodes=JSON.parse(JSON.stringify(tree.nodes)),this.apex=tree.apex}insert(id,val){if(id<=0)throw new Error("avl index ids are required to be numbers greater than zero");let node=this.nodes[id]={id:id,value:val,parent:null,balance:0,height:0,left:null,right:null,siblings:[]};this.apex?this.insertNode(this.nodes[this.apex],node):this.apex=id}insertNode(current,node){switch(this.comparator(node.value,current.value)){case 0:current.siblings.push(node.id),node.parent=current.id;break;case 1:current.right?(this.insertNode(this.nodes[current.right],node),this.updateBalance(current)):(current.right=node.id,node.parent=current.id,this.updateBalance(current));break;case-1:current.left?(this.insertNode(this.nodes[current.left],node),this.updateBalance(current)):(current.left=node.id,node.parent=current.id,this.updateBalance(current));break;default:throw new Error("Invalid comparator result")}if(current.balance<-1){if(null===current.left)throw new Error("insertNode.balance() : left child should not be null");this.nodes[current.left].balance<=0?this.leftLeftCase(current):this.leftRightCase(current)}if(current.balance>1){if(null===current.right)throw new Error("insertNode.balance() : right child should not be null");this.nodes[current.right].balance>=0?this.rightRightCase(current):this.rightLeftCase(current)}return current.height}updateBalance(node){let hl=node.left?this.nodes[node.left].height:-1,hr=node.right?this.nodes[node.right].height:-1;node.height=hl>hr?1+hl:1+hr,node.balance=hr-hl}leftLeftCase(node){return this.rotateRight(node)}leftRightCase(node){if(!node.left)throw new Error("leftRightCase: left child not set");return node.left=this.rotateLeft(this.nodes[node.left]).id,this.rotateRight(node)}rightRightCase(node){return this.rotateLeft(node)}rightLeftCase(node){if(!node.right)throw new Error("rightLeftCase: right child not set");return node.right=this.rotateRight(this.nodes[node.right]).id,this.rotateLeft(node)}rotateLeft(node){if(!node.right)throw new Error("rotateLeft: right child was unavailable.");let parent=node.parent?this.nodes[node.parent]:null,right=this.nodes[node.right];if(node.right=right.left,node.right&&(this.nodes[node.right].parent=node.id),right.left=node.id,right.parent=node.parent,node.parent=right.id,parent)if(parent.left===node.id)parent.left=right.id;else{if(parent.right!==node.id)throw new Error("rotateLeft() : attempt to remap parent back to child failed... not found");parent.right=right.id}else{if(this.apex!==node.id)throw new Error("rightRotate expecting parentless node to be apex");this.apex=right.id}return this.updateBalance(node),this.updateBalance(right),right}rotateRight(node){if(!node.left)throw new Error("rotateRight : left child unavailable");let parent=node.parent?this.nodes[node.parent]:null,left=this.nodes[node.left];if(node.left=left.right,left.right&&(this.nodes[left.right].parent=node.id),left.right=node.id,left.parent=node.parent,node.parent=left.id,parent)parent.left===node.id?parent.left=left.id:parent.right=left.id;else{if(this.apex!==node.id)throw new Error("rightRotate expecting parentless node to be apex");this.apex=left.id}return this.updateBalance(node),this.updateBalance(left),left}getValuesAsTree(node){return null===this.apex?null:{id:(node=node||this.nodes[this.apex]).id,val:node.value,siblings:node.siblings,balance:node.balance,height:node.height,left:node.left?this.getValuesAsTree(this.nodes[node.left]):null,right:node.right?this.getValuesAsTree(this.nodes[node.right]):null}}update(id,val){let node=this.nodes[id];0!==this.comparator(node.value,val)&&(this.remove(id),this.insert(id,val))}remove(id){if(!this.apex)throw new Error("remove() : attempting remove when tree has no apex");this.removeNode(this.nodes[this.apex],id)}removeNode(node,id){if(!this.nodes[id])throw new Error("removeNode: attempting to remove a node which is not in hashmap");let val=this.nodes[id].value;switch(this.comparator(val,node.value)){case 0:if(node.siblings.length>0){if(node.id===id){let alphaSiblingId=node.siblings.shift(),alphaSibling=this.nodes[alphaSiblingId];alphaSibling.parent=node.parent,this.updateChildLink(node.parent,id,alphaSiblingId),node.left&&(this.nodes[node.left].parent=alphaSiblingId),node.right&&(this.nodes[node.right].parent=alphaSiblingId),alphaSibling.left=node.left,alphaSibling.right=node.right,alphaSibling.siblings=node.siblings,alphaSibling.height=node.height,alphaSibling.balance=node.balance,this.apex===id&&(this.apex=alphaSiblingId);for(let si of alphaSibling.siblings)this.nodes[si].parent=alphaSiblingId;return void delete this.nodes[id]}{let idx=node.siblings.indexOf(id);if(-1===idx)throw new Error("Unable to remove sibling from parented sibling");return node.siblings.splice(idx,1),void delete this.nodes[id]}}return node.left||node.right?node.left&&node.right?void this.promoteSuccessor(node):(node.left&&(this.promoteChild(node,this.nodes[node.left]),this.apex===id&&(this.apex=node.left)),void(node.right&&(this.promoteChild(node,this.nodes[node.right]),this.apex===id&&(this.apex=node.right)))):(this.updateChildLink(node.parent,node.id,null),delete this.nodes[id],void(id===this.apex&&(this.apex=null)));case 1:if(!node.right)throw new Error("removeNode: Unable to find value in tree");this.removeNode(this.nodes[node.right],id);break;case-1:if(!node.left)throw new Error("removeNode: Unable to find value in tree");this.removeNode(this.nodes[node.left],id)}if(this.updateBalance(node),node.balance<-1){if(null===node.left)throw new Error("insertNode.balance() : left child should not be null");this.nodes[node.left].balance<=0?this.leftLeftCase(node):this.leftRightCase(node)}if(node.balance>1){if(null===node.right)throw new Error("insertNode.balance() : right child should not be null");this.nodes[node.right].balance>=0?this.rightRightCase(node):this.rightLeftCase(node)}}updateChildLink(parentId,oldChildId,newChildId){if(null===parentId)return;let parent=this.nodes[parentId];parent.left===oldChildId?parent.left=newChildId:parent.right===oldChildId&&(parent.right=newChildId)}promoteChild(parent,child){let gpId=parent.parent;if(gpId){let gp=this.nodes[gpId];gp.left===parent.id?gp.left=child.id:gp.right===parent.id&&(gp.right=child.id)}child.parent=gpId,delete this.nodes[parent.id]}promoteSuccessor(node){let oldId=node.id;if(!node.right||!node.left)throw new Error("promoteSuccessor() : node to replace does not have two children");let glsId,glsValue,glsSiblings,successor=null;if(node.balance<0){let lchild=this.nodes[node.left];successor=this.findGreaterLeaf(lchild),glsId=successor.id,glsValue=successor.value,glsSiblings=successor.siblings,successor.siblings=[],this.removeNode(lchild,glsId)}else{let rchild=this.nodes[node.right];successor=this.findLesserLeaf(rchild),glsId=successor.id,glsValue=successor.value,glsSiblings=successor.siblings,successor.siblings=[],this.removeNode(rchild,glsId)}if(node.parent){let p=this.nodes[node.parent];p.left===oldId&&(p.left=glsId),p.right===oldId&&(p.right=glsId)}node.left&&(this.nodes[node.left].parent=glsId),node.right&&(this.nodes[node.right].parent=glsId),node.id=glsId,node.value=glsValue,node.siblings=glsSiblings,this.nodes[glsId]=node,delete this.nodes[oldId],this.apex===oldId&&(this.apex=glsId),this.updateBalance(node)}findGreaterLeaf(node){if(!node.right)return node;let result=this.findGreaterLeaf(this.nodes[node.right]);return result||node}findLesserLeaf(node){if(!node.left)return node;let result=this.findLesserLeaf(this.nodes[node.left]);return result||node}rangeRequest(range){if(!this.apex)return[];if(!range)return this.collateIds(this.nodes[this.apex]);if("$eq"===range.op){let match=this.locate(this.nodes[this.apex],range.val);return null===match?[]:match.siblings.length?[match.id,...match.siblings]:[match.id]}return this.collateRequest(this.nodes[this.apex],range)}collateRequest(node,range){let result=[];if("$eq"===range.op)throw new Error("collateRequest does not support $eq range request");let cmp1=this.comparator(node.value,range.val),cmp2=0;if("$between"===range.op){if(null===range.high||void 0===range.high)throw new Error("collateRequest: $between request missing high range value");cmp2=this.comparator(node.value,range.high)}if(node.left)switch(range.op){case"$lt":case"$lte":result=this.collateRequest(this.nodes[node.left],range);break;case"$gt":case"$gte":case"$between":1===cmp1&&(result=this.collateRequest(this.nodes[node.left],range))}if(range)switch(range.op){case"$lt":-1===cmp1&&(result.push(node.id),result.push(...node.siblings));break;case"$lte":-1!==cmp1&&0!==cmp1||(result.push(node.id),result.push(...node.siblings));break;case"$gt":1===cmp1&&(result.push(node.id),result.push(...node.siblings));break;case"$gte":1!==cmp1&&0!==cmp1||(result.push(node.id),result.push(...node.siblings));break;case"$between":cmp1>=0&&cmp2<=0&&(result.push(node.id),result.push(...node.siblings))}else result.push(node.id),result.push(...node.siblings);if(node.right)if(range)switch(range.op){case"$lt":case"$lte":-1===cmp1&&result.push(...this.collateRequest(this.nodes[node.right],range));break;case"$gt":case"$gte":result.push(...this.collateRequest(this.nodes[node.right],range));break;case"$between":-1===cmp2&&result.push(...this.collateRequest(this.nodes[node.right],range))}else result.push(...this.collateRequest(this.nodes[node.right],range));return result}collateIds(node){let result=[];return node?(node.left&&(result=this.collateIds(this.nodes[node.left])),result.push(node.id),result.push(...node.siblings),node.right&&result.push(...this.collateIds(this.nodes[node.right])),result):[]}locate(node,val){for(;null!==node;)switch(this.comparator(val,node.value)){case 0:return node;case 1:if(!node.right)return null;node=this.nodes[node.right];break;case-1:if(!node.left)return null;node=this.nodes[node.left]}return null}validateIndex(){if(!this.apex)return 0===Object.keys(this.nodes).length;if(null!==this.nodes[this.apex].parent)return!1;let result=this.collateIds(this.nodes[this.apex]),nc=Object.keys(this.nodes).length;if(result.length!==nc)return!1;if(1===result.length)return null===this.nodes[result[0]].parent&&(null===this.nodes[result[0]].left&&null===this.nodes[result[0]].right);for(let i=0;i<result.length-1;i++)if(1===this.comparator(this.nodes[result[i]].value,this.nodes[result[i+1]].value))return!1;return this.validateNode(this.nodes[this.apex])}validateNode(node){if(-1!==[node.parent,node.left,node.right].indexOf(node.id))return!1;let hl=node.left?this.nodes[node.left].height:-1,hr=node.right?this.nodes[node.right].height:-1,eh=1+Math.max(hl,hr);if(node.height!==eh)return!1;if(node.balance!==hr-hl)return!1;if(node.siblings.length>0)for(let sid of node.siblings)if(this.nodes[sid].parent!==node.id)return!1;if(node.left){if(this.nodes[node.left].parent!==node.id)return!1;if(!this.validateNode(this.nodes[node.left]))return!1}if(node.right){if(this.nodes[node.right].parent!==node.id)return!1;if(!this.validateNode(this.nodes[node.right]))return!1}return!0}}__webpack_require__.d(__webpack_exports__,"a",(function(){return RangedIndexFactoryMap}));let RangedIndexFactoryMap={avl:(name,comparator)=>new AvlTreeIndex(name,comparator)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return LokiEventEmitter}));class LokiEventEmitter{constructor(){this._events={},this._asyncListeners=!1}on(eventName,listener){let event;return Array.isArray(eventName)?(eventName.forEach(currentEventName=>{this.on(currentEventName,listener)}),listener):(event=this._events[eventName],event||(event=this._events[eventName]=[]),event.push(listener),listener)}emit(eventName,...data){eventName&&this._events[eventName]&&this._events[eventName].forEach(listener=>{this._asyncListeners?setTimeout(()=>{listener(...data)},1):listener(...data)})}addListener(eventName,listener){return this.on(eventName,listener)}removeListener(eventName,listener){if(Array.isArray(eventName)&&eventName.forEach(currentEventName=>{this.removeListener(currentEventName,listener)}),this._events[eventName]){const listeners=this._events[eventName];listeners.splice(listeners.indexOf(listener),1)}}}},function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global){__webpack_require__.d(__webpack_exports__,"a",(function(){return Loki}));var _event_emitter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_collection__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_common_plugin__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_comparators__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0),_ranged_indexes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4),_operator_packages__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2);function getENV(){if(void 0!==global&&(global.android||global.NSObject))return"NATIVESCRIPT";if(void 0!==global&&"[object process]"==={}.toString.call(global.process))return global.window,"NODEJS";if(void 0!==document)return-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER";if(void 0!==window&&"[object Window]"==={}.toString.call(window))return"BROWSER";throw SyntaxError("Unknown environment...")}class Loki extends _event_emitter__WEBPACK_IMPORTED_MODULE_0__.a{constructor(filename="loki.db",options={}){if(super(),this.databaseVersion=1.5,this.engineVersion=1.5,this._persistenceMethod=null,this._persistenceAdapter=null,this._throttledSaves=!0,this._throttledSaveRunning=null,this._throttledSavePending=null,this._autosave=!1,this._autosaveInterval=5e3,this._autosaveRunning=!1,this._autosaveHandler=Promise.resolve(),this.filename=filename,this._collections=[],({serializationMethod:this._serializationMethod="normal",destructureDelimiter:this._destructureDelimiter="$<\n",env:this._env=getENV()}=options),this._events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},options.comparatorMap)for(let c in options.comparatorMap)_comparators__WEBPACK_IMPORTED_MODULE_3__.a[c]=options.comparatorMap[c];if(options.rangedIndexFactoryMap)for(let rif in options.rangedIndexFactoryMap)_ranged_indexes__WEBPACK_IMPORTED_MODULE_4__.a[rif]=options.rangedIndexFactoryMap[rif];if(options.lokiOperatorPackageMap)for(let lop in options.lokiOperatorPackageMap)_operator_packages__WEBPACK_IMPORTED_MODULE_5__.a[lop]=options.lokiOperatorPackageMap[lop];this.on("init",this.clearChanges)}initializePersistence(options={}){let loaded=this._autosaveDisable();({autosave:this._autosave=!1,autosaveInterval:this._autosaveInterval=5e3,persistenceMethod:this._persistenceMethod,throttledSaves:this._throttledSaves=!0}=options);const DEFAULT_PERSISTENCE={NODEJS:["fs-storage"],BROWSER:["local-storage","indexed-storage"],CORDOVA:["local-storage","indexed-storage"],MEMORY:["memory-storage"]},PERSISTENCE_METHODS={"fs-storage":_common_plugin__WEBPACK_IMPORTED_MODULE_2__.a.FSStorage,"local-storage":_common_plugin__WEBPACK_IMPORTED_MODULE_2__.a.LocalStorage,"indexed-storage":_common_plugin__WEBPACK_IMPORTED_MODULE_2__.a.IndexedStorage,"memory-storage":_common_plugin__WEBPACK_IMPORTED_MODULE_2__.a.MemoryStorage};if(void 0!==this._persistenceMethod){if("function"!=typeof PERSISTENCE_METHODS[this._persistenceMethod])throw Error("Unknown persistence method.");this._persistenceAdapter=new PERSISTENCE_METHODS[this._persistenceMethod]}if(void 0!==options.adapter&&(this._persistenceMethod="adapter",this._persistenceAdapter=options.adapter),null===this._persistenceAdapter){let possiblePersistenceMethods=DEFAULT_PERSISTENCE[this._env];if(possiblePersistenceMethods)for(let i=0;i<possiblePersistenceMethods.length;i++)if(PERSISTENCE_METHODS[possiblePersistenceMethods[i]]){this._persistenceMethod=possiblePersistenceMethods[i],this._persistenceAdapter=new PERSISTENCE_METHODS[possiblePersistenceMethods[i]];break}}return options.autoload&&(loaded=loaded.then(()=>this._loadDatabase(options.inflate,!0))),loaded.then(()=>{this._autosaveEnable()})}copy(options={}){const databaseCopy=new Loki(this.filename,{env:this._env});if(databaseCopy.loadJSONObject(this,{retainDirtyFlags:!0}),options.removeNonSerializable){databaseCopy._persistenceAdapter=null;for(let idx=0;idx<databaseCopy._collections.length;idx++)databaseCopy._collections[idx]._constraints=null,databaseCopy._collections[idx]._ttl=null}return databaseCopy}addCollection(name,options={}){for(let i=0;i<this._collections.length;i++)if(this._collections[i].name===name)return this._collections[i];const collection=new _collection__WEBPACK_IMPORTED_MODULE_1__.a(name,options);return this._collections.push(collection),collection}loadCollection(collection){if(!collection.name)throw new Error("Collection must have a name property to be loaded");this._collections.push(collection)}getCollection(name){for(let i=0;i<this._collections.length;i++)if(this._collections[i].name===name)return this._collections[i];return this.emit("warning","collection "+name+" not found"),null}renameCollection(oldName,newName){const c=this.getCollection(oldName);return c&&(c.name=newName),c}listCollections(){const colls=[];for(let i=0;i<this._collections.length;i++)colls.push({name:this._collections[i].name,count:this._collections[i].count()});return colls}removeCollection(collectionName){for(let i=0;i<this._collections.length;i++)if(this._collections[i].name===collectionName){const tmpcol=new _collection__WEBPACK_IMPORTED_MODULE_1__.a(collectionName,{}),curcol=this._collections[i];for(const prop in curcol)void 0!==curcol[prop]&&void 0!==tmpcol[prop]&&(curcol[prop]=tmpcol[prop]);return void this._collections.splice(i,1)}}serialize(options={}){switch(void 0===options.serializationMethod&&(options.serializationMethod=this._serializationMethod),options.serializationMethod){case"normal":return JSON.stringify(this);case"pretty":return JSON.stringify(this,null,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this)}}toJSON(){return{_env:this._env,_serializationMethod:this._serializationMethod,_autosave:this._autosave,_autosaveInterval:this._autosaveInterval,_collections:this._collections,databaseVersion:this.databaseVersion,engineVersion:this.engineVersion,filename:this.filename,_persistenceAdapter:this._persistenceAdapter,_persistenceMethod:this._persistenceMethod,_throttledSaves:this._throttledSaves}}serializeDestructured(options={}){if(void 0===options.partitioned&&(options.partitioned=!1),void 0===options.delimited&&(options.delimited=!0),void 0===options.delimiter&&(options.delimiter=this._destructureDelimiter),!0===options.partitioned&&void 0!==options.partition&&options.partition>=0)return this.serializeCollection({delimited:options.delimited,delimiter:options.delimiter,collectionIndex:options.partition});let dbcopy=new Loki(this.filename);dbcopy.loadJSONObject(this);for(let idx=0;idx<dbcopy._collections.length;idx++)dbcopy._collections[idx]._data=[];if(!0===options.partitioned&&-1===options.partition)return dbcopy.serialize({serializationMethod:"normal"});const reconstruct=[];reconstruct.push(dbcopy.serialize({serializationMethod:"normal"})),dbcopy=null;for(let idx=0;idx<this._collections.length;idx++){let result=this.serializeCollection({delimited:options.delimited,delimiter:options.delimiter,collectionIndex:idx});if(!1===options.partitioned&&!1===options.delimited){if(!Array.isArray(result))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(let sidx=0;sidx<result.length;sidx++)reconstruct.push(result[sidx]),result[sidx]=null;reconstruct.push("")}else reconstruct.push(result)}return options.partitioned?(options.delimited,reconstruct):options.delimited?(reconstruct.push(""),reconstruct.join(options.delimiter)):(reconstruct.push(""),reconstruct)}serializeCollection(options={}){if(void 0===options.delimited&&(options.delimited=!0),void 0===options.collectionIndex)throw new Error("serializeCollection called without 'collectionIndex' option");const doccount=this._collections[options.collectionIndex].count();let resultlines=[];for(let docidx=0;docidx<doccount;docidx++)resultlines.push(JSON.stringify(this._collections[options.collectionIndex]._data[docidx]));return options.delimited?(resultlines.push(""),resultlines.join(options.delimiter)):resultlines}deserializeDestructured(destructuredSource,options={}){if(void 0===options.partitioned&&(options.partitioned=!1),void 0===options.delimited&&(options.delimited=!0),void 0===options.delimiter&&(options.delimiter=this._destructureDelimiter),options.partitioned){if(void 0!==options.partition)return-1===options.partition?JSON.parse(destructuredSource[0]):this.deserializeCollection(destructuredSource[options.partition+1],options);const cdb=JSON.parse(destructuredSource[0]),collCount=cdb._collections.length;for(let collIndex=0;collIndex<collCount;collIndex++)cdb._collections[collIndex]._data=this.deserializeCollection(destructuredSource[collIndex+1],options);return cdb}let workarray=[];if(options.delimited){if(workarray=destructuredSource.split(options.delimiter),destructuredSource=null,0===workarray.length)return null}else workarray=destructuredSource;const cdb=JSON.parse(workarray[0]),collCount=cdb._collections.length;workarray[0]=null;let collIndex=0,lineIndex=1,done=!1;for(;!done;)""===workarray[lineIndex]?++collIndex>collCount&&(done=!0):cdb._collections[collIndex]._data.push(JSON.parse(workarray[lineIndex])),workarray[lineIndex++]=null;return cdb}deserializeCollection(destructuredSource,options={}){void 0===options.partitioned&&(options.partitioned=!1),void 0===options.delimited&&(options.delimited=!0),void 0===options.delimiter&&(options.delimiter=this._destructureDelimiter);let workarray=[];options.delimited?(workarray=destructuredSource.split(options.delimiter),workarray.pop()):workarray=destructuredSource;for(let idx=0;idx<workarray.length;idx++)workarray[idx]=JSON.parse(workarray[idx]);return workarray}loadJSON(serializedDb,options){let dbObject;if(0===serializedDb.length)dbObject={};else switch(this._serializationMethod){case"normal":case"pretty":dbObject=JSON.parse(serializedDb);break;case"destructured":dbObject=this.deserializeDestructured(serializedDb);break;default:dbObject=JSON.parse(serializedDb)}this.loadJSONObject(dbObject,options)}loadJSONObject(dbObject,options={}){const len=dbObject._collections?dbObject._collections.length:0;this.filename=dbObject.filename,this._collections=[];for(let i=0;i<len;++i)this._collections.push(_collection__WEBPACK_IMPORTED_MODULE_1__.a.fromJSONObject(dbObject._collections[i],options))}close(){return this._autosave?this._autosaveDisable().then(()=>this._autosaveDirty()?this.saveDatabase():Promise.resolve()):Promise.resolve().then(()=>{this.emit("close")})}generateChangesNotification(arrayOfCollectionNames){let changes=[];const selectedCollections=arrayOfCollectionNames||this._collections.map(coll=>coll.name);return this._collections.forEach(coll=>{-1!==selectedCollections.indexOf(coll.name)&&(changes=changes.concat(coll.getChanges()))}),changes}serializeChanges(collectionNamesArray){return JSON.stringify(this.generateChangesNotification(collectionNamesArray))}clearChanges(){this._collections.forEach(coll=>{coll.flushChanges&&coll.flushChanges()})}throttledSaveDrain(options={}){const now=(new Date).getTime();return this._throttledSaves?(void 0===options.recursiveWait&&(options.recursiveWait=!0),void 0===options.recursiveWaitLimit&&(options.recursiveWaitLimit=!1),void 0===options.recursiveWaitLimitDuration&&(options.recursiveWaitLimitDuration=2e3),void 0===options.started&&(options.started=new Date),this._throttledSaves&&null!==this._throttledSaveRunning?options.recursiveWait?Promise.resolve(Promise.all([this._throttledSaveRunning,this._throttledSavePending])).then(()=>null!==this._throttledSaveRunning||null!==this._throttledSavePending?options.recursiveWaitLimit&&now-options.started.getTime()>options.recursiveWaitLimitDuration?Promise.reject({}):this.throttledSaveDrain(options):Promise.resolve()):Promise.resolve(this._throttledSaveRunning):Promise.resolve()):Promise.resolve()}_loadDatabase(options={},ignore_not_found=!1){return null===this._persistenceAdapter?Promise.reject(new Error("persistenceAdapter not configured")):Promise.resolve(this._persistenceAdapter.loadDatabase(this.filename)).then(dbString=>{if("string"==typeof dbString)this.loadJSON(dbString,options),this.emit("load",this);else{if("object"!=typeof dbString||null===dbString||dbString instanceof Error)throw dbString;this.loadJSONObject(dbString,options),this.emit("load",this)}}).catch(e=>{if(e instanceof Error)throw e;if(null!=e)throw new TypeError("The persistence adapter did not load a serialized DB string or object.");if(!ignore_not_found)throw new Error("Database not found.")})}loadDatabase(options={}){return this._throttledSaves?this.throttledSaveDrain(options).then(()=>(this._throttledSaveRunning=this._loadDatabase(options).then(()=>{this._throttledSaveRunning=null}),this._throttledSaveRunning),()=>{throw new Error("Unable to pause save throttling long enough to read database")}):this._loadDatabase(options)}_saveDatabase(){return null===this._persistenceAdapter?Promise.reject(new Error("persistenceAdapter not configured")):"reference"===this._persistenceAdapter.mode&&"function"==typeof this._persistenceAdapter.exportDatabase?Promise.resolve(this._persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}))).then(()=>{this._autosaveClearFlags(),this.emit("save")}):(this._autosaveClearFlags(),Promise.resolve(this._persistenceAdapter.saveDatabase(this.filename,this.serialize())).then(()=>{this.emit("save")}))}saveDatabase(){return this._throttledSaves?(null!==this._throttledSaveRunning&&null===this._throttledSavePending&&(this._throttledSavePending=Promise.resolve(this._throttledSaveRunning).then(()=>(this._throttledSaveRunning=null,this._throttledSavePending=null,this.saveDatabase()))),null!==this._throttledSavePending?this._throttledSavePending:(this._throttledSaveRunning=this._saveDatabase().then(()=>{this._throttledSaveRunning=null}),this._throttledSaveRunning)):this._saveDatabase()}deleteDatabase(){return null===this._persistenceAdapter?Promise.reject(new Error("persistenceAdapter not configured")):Promise.resolve(this._persistenceAdapter.deleteDatabase(this.filename))}_autosaveDirty(){for(let idx=0;idx<this._collections.length;idx++)if(this._collections[idx]._dirty)return!0;return!1}_autosaveClearFlags(){for(let idx=0;idx<this._collections.length;idx++)this._collections[idx]._dirty=!1}_autosaveEnable(){if(!this._autosave||this._autosaveRunning)return;this._autosaveRunning=!0;const interval=setInterval(()=>{this._autosaveRunning?this._autosaveDirty()&&(this._autosaveHandler=this._autosaveHandler.then(()=>this.saveDatabase())):clearInterval(interval)},this._autosaveInterval)}_autosaveDisable(){return this._autosaveRunning=!1,this._autosaveHandler}}}).call(this,__webpack_require__(7))},function(module,exports){var g;g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _loki__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);__webpack_require__.d(__webpack_exports__,"Loki",(function(){return _loki__WEBPACK_IMPORTED_MODULE_0__.a}));var _collection__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);__webpack_require__.d(__webpack_exports__,"Collection",(function(){return _collection__WEBPACK_IMPORTED_MODULE_1__.a})),_loki__WEBPACK_IMPORTED_MODULE_0__.a.Collection=_collection__WEBPACK_IMPORTED_MODULE_1__.a,__webpack_exports__.default=_loki__WEBPACK_IMPORTED_MODULE_0__.a}])}))},1301:function(module,exports,__webpack_require__){!function webpackUniversalModuleDefinition(root,factory){module.exports=factory()}("undefined"!=typeof self&&self,(function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=1)}([function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global){function getGlobal(){let glob;return function(global){glob=global}(void 0!==global&&global||this),glob}__webpack_require__.d(__webpack_exports__,"a",(function(){return PLUGINS}));const PLUGINS=function create(){const global=getGlobal(),sym=Symbol.for("LOKI");return void 0===global[sym]&&(global[sym]={}),global[sym]}()}).call(this,__webpack_require__(2))},function(module,__webpack_exports__,__webpack_require__){"use strict";function whitespaceTokenizer(value){return value.split(/[\s]+/)}function lowercaseTokenFilter(token){return token.toLowerCase()}function uppercaseTokenFilter(token){return token.toUpperCase()}function analyze(analyzer,str){if(analyzer.char_filter)for(let j=0;j<analyzer.char_filter.length;j++)str=analyzer.char_filter[j](str);const tokens=analyzer.tokenizer(str);if(analyzer.token_filter)for(let i=0;i<tokens.length;i++)for(let k=0;k<analyzer.token_filter.length;k++)tokens[i]=analyzer.token_filter[k](tokens[i],i,tokens);return tokens.filter(token=>token)}__webpack_require__.r(__webpack_exports__);class analyzer_StandardAnalyzer{constructor(){this.tokenizer=whitespaceTokenizer,this.token_filter=[lowercaseTokenFilter]}}function toCodePoints(str){const r=[];for(let i=0;i<str.length;){const chr=str.charCodeAt(i++);if(chr>=55296&&chr<=56319){const low=str.charCodeAt(i++);r.push(65536+(chr-55296<<10)|low-56320)}else r.push(chr)}return r}class inverted_index_InvertedIndex{constructor(options={}){this.docCount=0,this.docStore=new Map,this.totalFieldLength=0,this.root=new Map,({store:this._store=!0,optimizeChanges:this._optimizeChanges=!0,analyzer:this.analyzer=new analyzer_StandardAnalyzer}=options)}insert(field,docId){if(this.docStore.has(docId))throw Error("Field already added.");const fieldTokens=analyze(this.analyzer,field);if(0==fieldTokens.length)return void this.docStore.set(docId,{fieldLength:0});this.totalFieldLength+=fieldTokens.length,this.docCount+=1,this.docStore.set(docId,{fieldLength:fieldTokens.length});const indexRef=[];this._optimizeChanges&&Object.defineProperties(this.docStore.get(docId),{indexRef:{enumerable:!1,configurable:!0,writable:!0,value:indexRef}});for(const token of new Set(fieldTokens)){let tf=0;for(let j=0;j<fieldTokens.length;j++)fieldTokens[j]===token&&++tf;let branch=this.root;for(const c of toCodePoints(token)){let child=branch.get(c);void 0===child&&(child=new Map,this._optimizeChanges&&(child.pa=branch),branch.set(c,child)),branch=child}void 0===branch.dc&&(branch.dc=new Map,branch.df=0),branch.dc.set(docId,tf),branch.df+=1,indexRef.push(branch)}}remove(docId){if(!this.docStore.has(docId))return;const docStore=this.docStore.get(docId);if(this.docStore.delete(docId),0!==docStore.fieldLength)if(this.docCount-=1,this.totalFieldLength-=docStore.fieldLength,this._optimizeChanges){const indexRef=docStore.indexRef;for(let j=0;j<indexRef.length;j++){let index=indexRef[j];if(index.df-=1,index.dc.delete(docId),0===index.df){if(delete index.df,delete index.dc,0!==index.size)continue;do{const parent=index.pa;delete index.pa;for(const key of parent.keys())if(parent.get(key)===index){parent.delete(key);break}index=parent}while(void 0!==index.pa&&0===index.size&&void 0===index.df)}}}else this._remove(this.root,docId)}static getTermIndex(term,root,start=0){if(start>=term.length)return null;for(let i=start;i<term.length;i++){let child=root.get(term[i]);if(void 0===child)return null;root=child}return root}static extendTermIndex(idx,term=[],termIndices=[]){void 0!==idx.df&&termIndices.push({index:idx,term:term.slice()}),term.push(0);for(const child of idx)term[term.length-1]=child[0],inverted_index_InvertedIndex.extendTermIndex(child[1],term,termIndices);return term.pop(),termIndices}toJSON(){return this._store?{_store:!0,_optimizeChanges:this._optimizeChanges,docCount:this.docCount,docStore:[...this.docStore],totalFieldLength:this.totalFieldLength,root:inverted_index_InvertedIndex._serializeIndex(this.root)}:{_store:!1,_optimizeChanges:this._optimizeChanges}}static fromJSONObject(serialized,analyzer){const invIdx=new inverted_index_InvertedIndex({store:serialized._store,optimizeChanges:serialized._optimizeChanges,analyzer:analyzer});return serialized._store&&(invIdx.docCount=serialized.docCount,invIdx.docStore=new Map(serialized.docStore),invIdx.totalFieldLength=serialized.totalFieldLength,invIdx.root=inverted_index_InvertedIndex._deserializeIndex(serialized.root)),invIdx._optimizeChanges&&invIdx._regenerate(invIdx.root,null),invIdx}static _serializeIndex(idx){const serialized={};if(void 0!==idx.dc&&(serialized.d={df:idx.df,dc:[...idx.dc]}),0===idx.size)return serialized;const keys=[],values=[];for(const child of idx)keys.push(child[0]),values.push(inverted_index_InvertedIndex._serializeIndex(child[1]));return serialized.k=keys,serialized.v=values,serialized}static _deserializeIndex(serialized){const idx=new Map;if(void 0!==serialized.k)for(let i=0;i<serialized.k.length;i++)idx.set(serialized.k[i],inverted_index_InvertedIndex._deserializeIndex(serialized.v[i]));return void 0!==serialized.d&&(idx.df=serialized.d.df,idx.dc=new Map(serialized.d.dc)),idx}_regenerate(index,parent){null!==parent&&(index.pa=parent);for(const child of index.values())this._regenerate(child,index);if(void 0!==index.dc)for(const docId of index.dc.keys()){const ref=this.docStore.get(docId);void 0===ref.indexRef&&Object.defineProperties(ref,{indexRef:{enumerable:!1,configurable:!0,writable:!0,value:[]}}),ref.indexRef.push(index)}}_remove(idx,docId){for(const child of idx)this._remove(child[1],docId)&&idx.delete(child[0]);return void 0!==idx.df&&idx.dc.has(docId)&&(idx.df-=1,idx.dc.delete(docId),0===idx.df&&(delete idx.df,delete idx.dc)),0===idx.size&&void 0===idx.dc}}class Scorer{constructor(invIdxs){this._cache={},this._invIdxs=invIdxs}setDirty(){this._cache={}}score(fieldName,boost,termIdx,doScoring,queryResults,term,df=0){if(null===termIdx||void 0===termIdx.dc)return;const idf=this._idf(fieldName,df||termIdx.df);for(const[docId,tf]of termIdx.dc)queryResults.has(docId)||queryResults.set(docId,[]),!0===doScoring?queryResults.get(docId).push({tf:tf,idf:idf,boost:boost,fieldName:fieldName,term:term}):!1===doScoring?queryResults.set(docId,[{boost:boost}]):queryResults.set(docId,[{boost:0}])}scoreConstant(boost,docId,queryResults){return queryResults.has(docId)||queryResults.set(docId,[]),queryResults.get(docId).push({boost:boost}),queryResults}finalScore(query,queryResults){const finalResult={},k1=void 0!==query.bm25?query.bm25.k1:1.2,b=void 0!==query.bm25?query.bm25.b:.75,explain=void 0!==query.explain&&query.explain;for(const[docId,result]of queryResults){let docScore=0,docExplanation=[];for(let i=0;i<result.length;i++){const queryResult=result[i];let score=0;if(void 0!==queryResult.tf){const tf=queryResult.tf,fieldLength=Scorer._calculateFieldLength(this._invIdxs[queryResult.fieldName].docStore.get(docId).fieldLength),avgFieldLength=this._avgFieldLength(queryResult.fieldName),tfNorm=tf*(k1+1)/(tf+k1*(1-b+b*(fieldLength/avgFieldLength)));score=queryResult.idf*tfNorm*queryResult.boost,explain&&docExplanation.push({boost:queryResult.boost,score:score,docID:docId,fieldName:queryResult.fieldName,index:String.fromCharCode(...queryResult.term),idf:queryResult.idf,tfNorm:tfNorm,tf:tf,fieldLength:fieldLength,avgFieldLength:avgFieldLength})}else score=queryResult.boost,explain&&docExplanation.push({boost:queryResult.boost,score:score});docScore+=score}finalResult[docId]=explain?{score:docScore,explanation:docExplanation}:{score:docScore}}return finalResult}static _calculateFieldLength(fieldLength){return fieldLength}_getCache(fieldName){if(void 0===this._cache[fieldName]){const avgFieldLength=this._invIdxs[fieldName].totalFieldLength/this._invIdxs[fieldName].docCount;this._cache[fieldName]={idfs:{},avgFieldLength:avgFieldLength}}return this._cache[fieldName]}_idf(fieldName,docFreq){const cache=this._getCache(fieldName);return void 0!==cache.idfs[docFreq]?cache.idfs[docFreq]:cache.idfs[docFreq]=Math.log(1+(this._invIdxs[fieldName].docCount-docFreq+.5)/(docFreq+.5))}_avgFieldLength(fieldName){return this._getCache(fieldName).avgFieldLength}}class RunAutomaton{constructor(automaton){const size=automaton.getNumStates();this._points=automaton.getStartPoints(),this._accept=new Array(size),this._transitions=new Array(size*this._points.length);for(let n=0;n<size;n++){this._accept[n]=automaton.isAccept(n);for(let c=0;c<this._points.length;c++)this._transitions[n*this._points.length+c]=automaton.step(n,this._points[c])}this._classmap=new Array(256);for(let i=0,j=0;j<this._classmap.length;j++)i+1<this._points.length&&j===this._points[i+1]&&i++,this._classmap[j]=i}getCharClass(c){let a=0,b=this._points.length;for(;b-a>1;){const d=a+b>>>1;if(this._points[d]>c)b=d;else{if(!(this._points[d]<c))return d;a=d}}return a}step(state,c){return c>=this._classmap.length?this._transitions[state*this._points.length+this.getCharClass(c)]:this._transitions[state*this._points.length+this._classmap[c]]}isAccept(state){return this._accept[state]}}function sortByDestMinMax(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:a[1]<b[1]?-1:a[1]>b[1]?1:a[2]<b[2]?-1:a[2]>b[2]?1:0}function sortByMinMaxDest(a,b){return a[1]<b[1]?-1:a[1]>b[1]?1:a[2]<b[2]?-1:a[2]>b[2]?1:a[0]<b[0]?-1:a[0]>b[0]?1:0}class Automaton{constructor(){this._stateTransitions=[],this._stateTransitions=[],this._accept=new Set,this._nextState=0,this._currState=-1,this._transitions={}}isAccept(n){return this._accept.has(n)}createState(){return this._nextState++}setAccept(state,accept){accept?this._accept.add(state):this._accept.delete(state)}finishState(){-1!==this._currState&&(this._finishCurrentState(),this._currState=-1)}_finishCurrentState(){this._stateTransitions.sort(sortByDestMinMax);let upto=0,p=[-1,-1,-1];for(let i=0,len=this._stateTransitions.length;i<len;i++){let t=this._stateTransitions[i];p[0]===t[0]?t[1]<=p[2]+1?t[2]>p[2]&&(p[2]=t[2]):(-1!==p[0]&&(this._stateTransitions[upto][0]=p[0],this._stateTransitions[upto][1]=p[1],this._stateTransitions[upto][2]=p[2],upto++),p[1]=t[1],p[2]=t[2]):(-1!==p[0]&&(this._stateTransitions[upto][0]=p[0],this._stateTransitions[upto][1]=p[1],this._stateTransitions[upto][2]=p[2],upto++),p[0]=t[0],p[1]=t[1],p[2]=t[2])}-1!==p[0]&&(this._stateTransitions[upto][0]=p[0],this._stateTransitions[upto][1]=p[1],this._stateTransitions[upto][2]=p[2],upto++),this._transitions[this._currState]=this._stateTransitions.slice(0,upto).sort(sortByMinMaxDest),this._stateTransitions=[]}getStartPoints(){const pointset=new Set;pointset.add(0);const states=Object.keys(this._transitions);for(let i=0;i<states.length;i++){let trans=this._transitions[states[i]];for(let j=0;j<trans.length;j++){let tran=trans[j];pointset.add(tran[1]),tran[2]<1114111&&pointset.add(tran[2]+1)}}return Array.from(pointset).sort((a,b)=>a-b)}step(state,label){let trans=this._transitions[state];if(trans)for(let i=0;i<trans.length;i++){let tran=trans[i];if(tran[1]<=label&&label<=tran[2])return tran[0]}return-1}getNumStates(){return this._nextState}addTransition(source,dest,min,max){this._currState!==source&&(-1!==this._currState&&this._finishCurrentState(),this._currState=source),this._stateTransitions.push([dest,min,max])}}class Long{constructor(low=0,high=0){this._low=low,this._high=high}shiftRight(numBits){return 0==(numBits&=63)?this:numBits<32?new Long(this._low>>>numBits|this._high<<32-numBits,this._high>>numBits):new Long(this._high>>numBits-32,this._high>=0?0:-1)}shiftLeft(numBits){return 0==(numBits&=63)?this:numBits<32?new Long(this._low<<numBits,this._high<<numBits|this._low>>>32-numBits):new Long(0,this._low<<numBits-32)}and(other){return new Long(this._low&other._low,this._high&other._high)}toInt(){return this._low}}const MASKS=[new Long(1),new Long(3),new Long(7),new Long(15),new Long(31),new Long(63),new Long(127),new Long(255),new Long(511),new Long(1023),new Long(2047),new Long(4095),new Long(8191),new Long(16383),new Long(32767),new Long(65535),new Long(15,8191),new Long(15,16383),new Long(15,32767),new Long(15,65535),new Long(255,8191),new Long(255,16383),new Long(255,32767),new Long(255,65535),new Long(4095,8191),new Long(4095,16383),new Long(4095,32767),new Long(4095,65535),new Long(65535,8191),new Long(65535,16383),new Long(65535,32767),new Long(65535,65535),new Long(1048575,8191),new Long(1048575,16383),new Long(1048575,32767),new Long(1048575,65535),new Long(16777215,8191),new Long(16777215,16383),new Long(16777215,32767),new Long(16777215,65535),new Long(268435455,8191),new Long(268435455,16383),new Long(268435455,32767),new Long(268435455,65535),new Long(4294967295,8191),new Long(4294967295,16383),new Long(4294967295,32767),new Long(4294967295,65535),new Long(68719476735,8191),new Long(68719476735,16383),new Long(68719476735,32767),new Long(68719476735,65535),new Long(0xffffffffff,8191),new Long(0xffffffffff,16383),new Long(0xffffffffff,32767),new Long(0xffffffffff,65535),new Long(0xfffffffffff,8191),new Long(0xfffffffffff,16383),new Long(0xfffffffffff,32767),new Long(0xfffffffffff,65535),new Long(0xffffffffffff,8191),new Long(0xffffffffffff,16383),new Long(0xffffffffffff,32767)];class ParametricDescription{constructor(w,n,minErrors){this._w=w,this._n=n,this._minErrors=minErrors}size(){return this._minErrors.length*(this._w+1)}isAccept(absState){let state=Math.floor(absState/(this._w+1)),offset=absState%(this._w+1);return this._w-offset+this._minErrors[state]<=this._n}getPosition(absState){return absState%(this._w+1)}static unpack(data,index,bitsPerValue){const bitLoc=bitsPerValue*index,dataLoc=bitLoc>>6,bitStart=63&bitLoc;if(bitStart+bitsPerValue<=64)return data[dataLoc].shiftRight(bitStart).and(MASKS[bitsPerValue-1]).toInt();{const part=64-bitStart;return data[dataLoc].shiftRight(bitStart).and(MASKS[part-1]).toInt()+data[1+dataLoc].and(MASKS[bitsPerValue-part-1]).shiftLeft(part).toInt()}}}const toStates0=[new Long(2)],offsetIncrs0=[new Long(0)],toStates1=[new Long(2627)],offsetIncrs1=[new Long(56)],toStates2=[new Long(2182348803,877873428),new Long(109)],offsetIncrs2=[new Long(1436680192,21845)],toStates3=[new Long(2416705539,559024212),new Long(1161073005,1531779490),new Long(55860)],offsetIncrs3=[new Long(553385984,1431678474),new Long(1431655765)];class lev1t_parametric_description_Lev1TParametricDescription extends ParametricDescription{constructor(w){super(w,1,[0,1,0,-1,-1,-1])}transition(absState,position,vector){let state=Math.floor(absState/(this._w+1)),offset=absState%(this._w+1);if(position===this._w){if(state<2){const loc=2*vector+state;offset+=ParametricDescription.unpack(offsetIncrs0,loc,1),state=ParametricDescription.unpack(toStates0,loc,2)-1}}else if(position===this._w-1){if(state<3){const loc=3*vector+state;offset+=ParametricDescription.unpack(offsetIncrs1,loc,1),state=ParametricDescription.unpack(toStates1,loc,2)-1}}else if(position===this._w-2){if(state<6){const loc=6*vector+state;offset+=ParametricDescription.unpack(offsetIncrs2,loc,2),state=ParametricDescription.unpack(toStates2,loc,3)-1}}else if(state<6){const loc=6*vector+state;offset+=ParametricDescription.unpack(offsetIncrs3,loc,2),state=ParametricDescription.unpack(toStates3,loc,3)-1}return-1===state?-1:state*(this._w+1)+offset}}const lev2t_parametric_description_toStates0=[new Long(35)],lev2t_parametric_description_offsetIncrs0=[new Long(0)],lev2t_parametric_description_toStates1=[new Long(325618500)],lev2t_parametric_description_offsetIncrs1=[new Long(992)],lev2t_parametric_description_toStates2=[new Long(1375778052,1625010352),new Long(654713383,1379082614),new Long(338833973,592794674),new Long(17236)],lev2t_parametric_description_offsetIncrs2=[new Long(8192,1431339176),new Long(1431655765,85)],lev2t_parametric_description_toStates3=[new Long(1074107396,3875651625),new Long(10813440,2685408800),new Long(2705416840,2955709504),new Long(822630592,176295986),new Long(220770817,826549144),new Long(2222426336,1384244520),new Long(146941966,2721677523),new Long(2841782156,506631345),new Long(579396904,2353082526),new Long(35310113,289686537),new Long(2259748971,295985736),new Long(492978372,711088276),new Long(1217426605,1344578827),new Long(1376534810,344070858),new Long(190401092,1485354377),new Long(3289490533,2484954400),new Long(2909430484,2337837173),new Long(441472420)],lev2t_parametric_description_offsetIncrs3=[new Long(8192,3195650),new Long(3288085308,704655603),new Long(2189600800,591003698),new Long(850559912,1431655765),new Long(1431655765,1431655765),new Long(1431655765,1431655765),new Long(1431655765,1431655765)],toStates4=[new Long(2904068,58725456),new Long(3640,3305111883),new Long(1363153922,1300),new Long(0),new Long(335609856,85458955),new Long(685900336,166838792),new Long(2198499522,564071920),new Long(136348160,2181038210),new Long(1619003392,134546689),new Long(39855683,813828486),new Long(1347453028,1164181826),new Long(536873009,139461908),new Long(2231378050,1094735904),new Long(160481793,1164017816),new Long(1352667217,137456908),new Long(84799712,558175264),new Long(340820500,219423040),new Long(1350704224,1008844824),new Long(3407093895,30086147),new Long(407994924,2148016453),new Long(545259552,2097672),new Long(2266497861,3490060320),new Long(613903113,3406463435),new Long(1648822737,145860110),new Long(2183434377,38340640),new Long(13811748,3272876486),new Long(356860963,1009861909),new Long(3256660288,830815266),new Long(740327956,1158959115),new Long(1351286865,141656116),new Long(1359540421,2999666001),new Long(481339408,3894702429),new Long(2425032288,337824532),new Long(3224154437,813771810),new Long(212943372,2216698370),new Long(550373456,1545653768),new Long(2332913858,545392672),new Long(337723912,1107841154),new Long(1350765600,153125696),new Long(325399954,3323153862),new Long(1841617741,3540595740),new Long(1423134004,1680136456),new Long(50861250,2449943586),new Long(614664496,1109422667),new Long(633938146,611374880),new Long(2539425922,2462657904),new Long(76697096,3406332098),new Long(3259769985,1165203240),new Long(3663819994,3336195509),new Long(1563465501,1264399831),new Long(2474794210,271614300),new Long(34386245,1363419217),new Long(740429356,3308790030),new Long(1389038960,139543060),new Long(2232701250,541788240),new Long(1079067660,2450874499),new Long(2785961365,1298533965),new Long(476956248,2497254628),new Long(341103461,2187601497),new Long(1359153171,680658732),new Long(3408700171,3804373106),new Long(542345488,1160540375),new Long(1888368785,145935149),new Long(3255087694,2177569856),new Long(683854372,3661947790),new Long(2245419236,499571301),new Long(2388496718,3804978483),new Long(949191224)],offsetIncrs4=[new Long(524288,805437440),new Long(2146400),new Long(67108864,2169044992),new Long(276973604,1076138561),new Long(1610621058,3680514243),new Long(807079296,1815527532),new Long(897243,2954387888),new Long(2441666669,460338720),new Long(114847159,134255104),new Long(37758096,76680228),new Long(136613897,4784130),new Long(672286724,1225265793),new Long(306857122,880804100),new Long(220463628,3272159376),new Long(616713508,1073781257),new Long(2449540634,77089286),new Long(1898353250,1229784210),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,9362)],toStates5=[new Long(2904068,58725456),new Long(3640,3305111883),new Long(1363153922,1300),new Long(0),new Long(335609856,85196811),new Long(59637984,5570560),new Long(100708736,642062416),new Long(136348168,2181570690),new Long(1082263584,181504),new Long(2156659014,1887570488),new Long(2620424828,3279691970),new Long(545261671,2130440),new Long(33562752,2973765664),new Long(5341184,2190352419),new Long(547298336,137406220),new Long(2235429087,1363481680),new Long(340820500,370417986),new Long(813715536,1613103716),new Long(1124606104,621086726),new Long(341196820,1107296387),new Long(545587281,139461128),new Long(336856450,2157513760),new Long(136714249,2181140994),new Long(2416314689,143787289),new Long(3257709122,575218834),new Long(23218476,1124599045),new Long(2248302630,2151761173),new Long(3316920642,935559200),new Long(340819988,1107841157),new Long(1350893649,21053528),new Long(2550763714,1363501440),new Long(206610448,3758633325),new Long(1351295472,743623468),new Long(3257709129,1611476114),new Long(407929372,2268864960),new Long(63640608,738315028),new Long(1159221634,545261601),new Long(136347648,1157636098),new Long(545724419,141559316),new Long(84419023,1946484981),new Long(408981504,2471335494),new Long(813845808,1277481805),new Long(3321943618,25561121),new Long(635093620,3265295049),new Long(2445440114,745112472),new Long(2300846658,2453800992),new Long(883951872,2181591424),new Long(2963079265,481446262),new Long(2635903144,1625695344),new Long(359976510,3541325271),new Long(633494900,476056888),new Long(1111241026,1364284500),new Long(335790868,3257672139),new Long(558045267,11715080),new Long(85217605,54855856),new Long(206604056,1427443855),new Long(4060419156,141821184),new Long(102297744,3797110162),new Long(1704116792,1228416601),new Long(566624470,1143194388),new Long(3408729413,1925357634),new Long(2693907828,1110194563),new Long(1351298130,11715860),new Long(2150936715,4039444593),new Long(1162957064,2819666635),new Long(1901927600,576776228),new Long(2385343694,3864603731),new Long(949191224,1108095105),new Long(570559665,139494432),new Long(3456639182,1891785760),new Long(136350477,1107828866),new Long(1350702113,203440648),new Long(2200719491,554174592),new Long(137937428,2768779394),new Long(2848166960,2863311530),new Long(2678717098,447381162),new Long(337691400,2185765072),new Long(2228833636,1904530289),new Long(460404435,885148935),new Long(355783501,2567517762),new Long(818021680,137626888),new Long(1398349970,886858038),new Long(1303698529,2759444188),new Long(1227133514,2450169746),new Long(2173872170,1925324848),new Long(814942496,119845450),new Long(2450400290,225575516),new Long(3372753479,2463566197),new Long(618694956,2282496073),new Long(3259505840,747801636),new Long(2299037513,2158306440),new Long(2865185684,1787173674),new Long(2871505528,135998630),new Long(120332803,2735288466),new Long(1763036764,3614016979),new Long(1998285110,1567933020),new Long(2301457623,1917716851),new Long(142656005,1277460939),new Long(1939286210,1635048005),new Long(3662525914,1252095430),new Long(2252890502,1787206439),new Long(813795018,212944144),new Long(1142968578,571354193),new Long(941690412,3406655685),new Long(1363285074,340869640),new Long(1258836101,1363414048),new Long(339772204,3407106312),new Long(1217071240,2486264328),new Long(2675866051,4205477370),new Long(2124930941,50862570),new Long(550507601,1701086552),new Long(2473165721,2517850499),new Long(956767089,3647288901),new Long(2521109812,81828105),new Long(85213378,559286324),new Long(1625708889,3596674266),new Long(3336332676,2449992057),new Long(3750905888,2821358087),new Long(271614374,2300605125),new Long(2999595186,740427564),new Long(87593230,1388776818),new Long(149129492,2334962391),new Long(541795552,481379340),new Long(2351735368,2269850802),new Long(608733960,1133805922),new Long(2602532471,2658691750),new Long(3970345447,1359153177),new Long(680658732,2386076427),new Long(2207475987,1771444057),new Long(1161328411,1959672182),new Long(149130029,3255099982),new Long(2177569856,683854372),new Long(3661947790,2245419236),new Long(1975966309,1770391529),new Long(2582087242,2798283430)],offsetIncrs5=[new Long(524288,805437440),new Long(2146400),new Long(67108864,16777216),new Long(1348481048,3681400539),new Long(11702,2759852034),new Long(1092883008,306782344),new Long(1065248,1073742080),new Long(2450071634,613598240),new Long(157651673,204527616),new Long(3277862616,2954562566),new Long(1815534349,409731075),new Long(2954587142,2911241057),new Long(1533925085,905970103),new Long(230032140,3289526556),new Long(3068358150,56077),new Long(3674310171,152604166),new Long(1907829602,7198427),new Long(8390944,1076101705),new Long(2420711618,545409280),new Long(1074040832,302064768),new Long(2760925472,1428467018),new Long(38273045,1083326496),new Long(1212191753,2454856978),new Long(603981856,1226838017),new Long(541721760,689080612),new Long(349513,2416455890),new Long(616710196,154440460),new Long(40379539,68708608),new Long(1629493832,2588509714),new Long(894585300,204767233),new Long(2483889154,616827184),new Long(153412173,440402074),new Long(110231814,1644468298),new Long(2456888978,2454277460),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756,1227133513),new Long(2454267026,613566756),new Long(1227133513,2454267026),new Long(613566756)];class lev2t_parametric_description_Lev2TParametricDescription extends ParametricDescription{constructor(w){super(w,2,[0,2,1,0,1,0,-1,0,0,-1,0,-1,-1,-1,-1,-1,-2,-1,-1,-1,-2,-1,-1,-2,-1,-1,-2,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2])}transition(absState,position,vector){let state=Math.floor(absState/(this._w+1)),offset=absState%(this._w+1);if(position===this._w){if(state<3){const loc=3*vector+state;offset+=ParametricDescription.unpack(lev2t_parametric_description_offsetIncrs0,loc,1),state=ParametricDescription.unpack(lev2t_parametric_description_toStates0,loc,2)-1}}else if(position===this._w-1){if(state<5){const loc=5*vector+state;offset+=ParametricDescription.unpack(lev2t_parametric_description_offsetIncrs1,loc,1),state=ParametricDescription.unpack(lev2t_parametric_description_toStates1,loc,3)-1}}else if(position===this._w-2){if(state<13){const loc=13*vector+state;offset+=ParametricDescription.unpack(lev2t_parametric_description_offsetIncrs2,loc,2),state=ParametricDescription.unpack(lev2t_parametric_description_toStates2,loc,4)-1}}else if(position===this._w-3){if(state<28){const loc=28*vector+state;offset+=ParametricDescription.unpack(lev2t_parametric_description_offsetIncrs3,loc,2),state=ParametricDescription.unpack(lev2t_parametric_description_toStates3,loc,5)-1}}else if(position===this._w-4){if(state<45){const loc=45*vector+state;offset+=ParametricDescription.unpack(offsetIncrs4,loc,3),state=ParametricDescription.unpack(toStates4,loc,6)-1}}else if(state<45){const loc=45*vector+state;offset+=ParametricDescription.unpack(offsetIncrs5,loc,3),state=ParametricDescription.unpack(toStates5,loc,6)-1}return-1===state?-1:state*(this._w+1)+offset}}class levenshtein_automata_LevenshteinAutomata{constructor(input,editDistance){this._word=input,this._editDistance=editDistance,this._alphabet=[...new Set(this._word)].sort((a,b)=>a-b),this._numRanges=0,this._rangeLower=new Array(this._alphabet.length+2),this._rangeUpper=new Array(this._alphabet.length+2);let lower=0;for(let i=0;i<this._alphabet.length;i++){const higher=this._alphabet[i];higher>lower&&(this._rangeLower[this._numRanges]=lower,this._rangeUpper[this._numRanges]=higher-1,this._numRanges++),lower=higher+1}lower<=1114111&&(this._rangeLower[this._numRanges]=lower,this._rangeUpper[this._numRanges]=1114111,this._numRanges++),this._description=1===editDistance?new lev1t_parametric_description_Lev1TParametricDescription(input.length):new lev2t_parametric_description_Lev2TParametricDescription(input.length)}toAutomaton(){let automat=new Automaton;const range=2*this._editDistance+1,numStates=this._description.size();automat.createState();for(let i=1;i<numStates;i++){let state=automat.createState();automat.setAccept(state,this._description.isAccept(i))}for(let k=0;k<numStates;k++){const xpos=this._description.getPosition(k);if(xpos<0)continue;const end=xpos+Math.min(this._word.length-xpos,range);for(let x=0;x<this._alphabet.length;x++){const ch=this._alphabet[x],cvec=this._getVector(ch,xpos,end),dest=this._description.transition(k,xpos,cvec);dest>=0&&automat.addTransition(k,dest,ch,ch)}const dest=this._description.transition(k,xpos,0);if(dest>=0)for(let r=0;r<this._numRanges;r++)automat.addTransition(k,dest,this._rangeLower[r],this._rangeUpper[r])}return automat.finishState(),automat}_getVector(x,pos,end){let vector=0;for(let i=pos;i<end;i++)vector<<=1,this._word[i]===x&&(vector|=1);return vector}}class index_searcher_IndexSearcher{constructor(invIdxs,docs){this._invIdxs=invIdxs,this._docs=docs,this._scorer=new Scorer(this._invIdxs)}search(query){let queryResults=this._recursive(query.query,!0);if(void 0===query.calculate_scoring||query.calculate_scoring)return this._scorer.finalScore(query,queryResults);const result={};for(const key of queryResults.keys())result[key]={score:1};return result}setDirty(){this._scorer.setDirty()}_recursive(query,doScoring){let queryResults=new Map;const boost=void 0!==query.boost?query.boost:1,fieldName=void 0!==query.field?query.field:null;let root=null,analyzer=null;switch(void 0!==this._invIdxs[fieldName]&&(root=this._invIdxs[fieldName].root,analyzer=this._invIdxs[fieldName].analyzer),query.type){case"bool":if(queryResults=null,void 0!==query.must&&(queryResults=this._getUnique(query.must,doScoring,queryResults)),void 0!==query.filter&&(queryResults=this._getUnique(query.filter,null,queryResults)),void 0!==query.should){const shouldDocs=this._getAll(query.should,doScoring);let empty=!1;null===queryResults&&(empty=!0,queryResults=new Map);const msm=Math.max(1,function calculateMinShouldMatch(optionalClauseCount,spec){if(void 0===spec)return 1;if("number"==typeof spec)return spec<0?optionalClauseCount+spec:spec;let result=optionalClauseCount;if(spec.includes("<")){for(const s of spec.split(" ")){const parts=s.split("<");if(optionalClauseCount<=parseInt(parts[0]))return result;result=calculateMinShouldMatch(optionalClauseCount,parts[1])}return result}if(spec.includes("%")){const calc=result*parseInt(spec.slice(0,-1))*.01;result=calc<0?result+Math.ceil(calc):Math.floor(calc)}else{const calc=parseInt(spec);result=calc<0?result+calc:calc}return result<1?1:result}(query.should.length,query.minimum_should_match));if(empty&&1===msm)queryResults=shouldDocs;else for(const[docId,res]of shouldDocs)res.length>=msm&&(queryResults.has(docId)?queryResults.get(docId).push(...res):empty?queryResults.set(docId,res):queryResults.delete(docId))}if(null===queryResults&&(queryResults=this._recursive({type:"match_all"},!1)),void 0!==query.not){let notDocs=this._getAll(query.not,null);for(const docId of notDocs.keys())queryResults.has(docId)&&queryResults.delete(docId)}if(1!==boost)for(const[_,result]of queryResults)for(let i=0;i<result.length;i++)result[i].boost*=boost;break;case"term":{const cps=toCodePoints(query.value);let termIdx=inverted_index_InvertedIndex.getTermIndex(cps,root);this._scorer.score(fieldName,boost,termIdx,doScoring,queryResults,cps);break}case"terms":for(let i=0;i<query.value.length;i++){const cps=toCodePoints(query.value[i]);let termIdx=inverted_index_InvertedIndex.getTermIndex(cps,root);this._scorer.score(fieldName,boost,termIdx,doScoring,queryResults,cps)}break;case"fuzzy":{const[f,idf]=function fuzzySearch(query,root){let value=toCodePoints(query.value),fuzziness=void 0!==query.fuzziness?query.fuzziness:"AUTO";"AUTO"===fuzziness&&(fuzziness=value.length<=2?0:value.length<=5?1:2);let prefixLength=void 0!==query.prefix_length?query.prefix_length:0,extended=void 0!==query.extended&&query.extended;0===fuzziness&&(prefixLength=value.length);let result=[],startIdx=root,prefix=value.slice(0,prefixLength),fuzzy=value,df=0;0!==prefixLength&&(startIdx=inverted_index_InvertedIndex.getTermIndex(prefix,startIdx),fuzzy=fuzzy.slice(prefixLength));if(null===startIdx)return[result,df];if(0===fuzzy.length){if(extended){const all=inverted_index_InvertedIndex.extendTermIndex(startIdx);for(let i=0;i<all.length;i++)result.push({index:all[i].index,term:all[i].term,boost:1}),df=Math.max(df,all[i].index.df)}else void 0!==startIdx.dc&&(result.push({index:startIdx,term:value,boost:1}),df=startIdx.df);return[result,df]}const term=[0],automaton=new RunAutomaton(new levenshtein_automata_LevenshteinAutomata(fuzzy,fuzziness).toAutomaton());function determineEditDistance(state,term,fuzzy){let ed=0;if(-1!==(state=automaton.step(state,0))&&automaton.isAccept(state)&&(ed++,-1!==(state=automaton.step(state,0))&&automaton.isAccept(state)&&ed++,term.length<fuzzy.length)){if(ed!==fuzziness)return function calculateLevenshteinDistance(a,b){let i,j,prev,val;const row=Array(a.length+1);for(i=0;i<=a.length;i++)row[i]=i;for(i=1;i<=b.length;i++){for(prev=i,j=1;j<=a.length;j++)b[i-1]===a[j-1]?val=row[j-1]:(val=Math.min(row[j-1]+1,Math.min(prev+1,row[j]+1)),i>1&&j>1&&b[i-2]===a[j-1]&&a[j-2]===b[i-1]&&(val=Math.min(val,row[j-1]-(a[j-1]===b[i-1]?1:0)))),row[j-1]=prev,prev=val;row[a.length]=prev}return row[a.length]}(term,fuzzy);ed-=fuzzy.length-term.length}return fuzziness-ed}function recursive(state,key,idx){if(term[term.length-1]=key,-1!==(state=automaton.step(state,key))){if(automaton.isAccept(state)){if(extended){const all=inverted_index_InvertedIndex.extendTermIndex(idx);for(let i=0;i<all.length;i++)result.push({index:all[i].index,term:all[i].term,boost:1}),df=Math.max(df,all[i].index.df);return}if(void 0!==idx.df){const distance=determineEditDistance(state,term,fuzzy),boost=Math.max(0,1-distance/Math.min(prefix.length+term.length,value.length));result.push({index:idx,term:[...prefix,...term],boost:boost}),df=Math.max(df,idx.df)}}term.push(0);for(const child of idx)recursive(state,child[0],child[1]);term.pop()}}for(const child of startIdx)recursive(0,child[0],child[1]);return[result,df]}(query,root);for(let i=0;i<f.length;i++)this._scorer.score(fieldName,boost*f[i].boost,f[i].index,doScoring,queryResults,f[i].term,idf);break}case"wildcard":{const enableScoring=void 0!==query.enable_scoring&&query.enable_scoring,w=function wildcardSearch(query,root){let wildcard=toCodePoints(query.value),result=[];return function recursive(index,idx=0,term=[],escaped=!1){if(null===index)return;if(idx===wildcard.length)return void(void 0!==index.df&&result.push({index:index,term:term.slice()}));if(escaped||92!==wildcard[idx])if(escaped||63!==wildcard[idx])if(escaped||42!==wildcard[idx])recursive(inverted_index_InvertedIndex.getTermIndex([wildcard[idx]],index),idx+1,[...term,wildcard[idx]]);else if(idx+1===wildcard.length){const all=inverted_index_InvertedIndex.extendTermIndex(index);for(let i=0;i<all.length;i++)recursive(all[i].index,idx+1,[...term,...all[i].term])}else{recursive(index,idx+1,term,!1);const indices=[{index:index,term:[]}];do{const index=indices.pop();for(const child of index.index)recursive(child[1],idx+1,[...term,...index.term,child[0]]),indices.push({index:child[1],term:[...index.term,child[0]]})}while(0!==indices.length)}else for(const child of index)recursive(child[1],idx+1,[...term,child[0]]);else recursive(index,idx+1,term,!0)}(root),result}(query,root);for(let i=0;i<w.length;i++)this._scorer.score(fieldName,boost,w[i].index,doScoring&&enableScoring,queryResults,w[i].term);break}case"match_all":for(let docId of this._docs)this._scorer.scoreConstant(boost,docId,queryResults);break;case"constant_score":{let tmpQueryResults=this._getAll(query.filter,!1);for(const docId of tmpQueryResults.keys())this._scorer.scoreConstant(boost,docId,queryResults);break}case"prefix":{const enableScoring=void 0!==query.enable_scoring&&query.enable_scoring,cps=toCodePoints(query.value),termIdx=inverted_index_InvertedIndex.getTermIndex(cps,root);if(null!==termIdx){const termIdxs=inverted_index_InvertedIndex.extendTermIndex(termIdx);for(let i=0;i<termIdxs.length;i++)this._scorer.score(fieldName,boost,termIdxs[i].index,doScoring&&enableScoring,queryResults,[...cps,...termIdxs[i].term])}break}case"exists":if(null!==root)for(const docId of this._invIdxs[fieldName].docStore.keys())this._scorer.scoreConstant(boost,docId,queryResults);break;case"match":{const terms=analyze(analyzer,query.value),boolQuery={type:"bool"},subQueries=[];if("or"===(void 0!==query.operator?query.operator:"or")?(void 0!==query.minimum_should_match&&(boolQuery.minimum_should_match=query.minimum_should_match),boolQuery.should=subQueries):boolQuery.must=subQueries,boolQuery.boost=boost,void 0!==query.fuzziness){let prefixLength=void 0!==query.prefix_length?query.prefix_length:2,extended=void 0!==query.extended&&query.extended;for(let i=0;i<terms.length;i++)subQueries.push({type:"fuzzy",field:fieldName,value:terms[i],fuzziness:query.fuzziness,prefix_length:prefixLength,extended:extended})}else for(let i=0;i<terms.length;i++)subQueries.push({type:"term",field:fieldName,value:terms[i]});queryResults=this._recursive(boolQuery,doScoring);break}}return queryResults}_getUnique(queries,doScoring,queryResults){if(0===queries.length)return queryResults;for(let i=0;i<queries.length;i++){let currDocs=this._recursive(queries[i],doScoring);if(null!==queryResults)for(const docId of queryResults.keys())currDocs.has(docId)?queryResults.get(docId).push(...currDocs.get(docId)):queryResults.delete(docId);else queryResults=this._recursive(queries[0],doScoring)}return queryResults}_getAll(queries,doScoring,queryResults=new Map){for(let i=0;i<queries.length;i++){let currDocs=this._recursive(queries[i],doScoring);for(const docId of currDocs.keys())queryResults.has(docId)?queryResults.get(docId).push(...currDocs.get(docId)):queryResults.set(docId,currDocs.get(docId))}return queryResults}}var common_plugin=__webpack_require__(0);class full_text_search_FullTextSearch{constructor(fieldOptions=[],id){this._invIdxs={};for(let i=0;i<fieldOptions.length;i++){let fieldOption=fieldOptions[i];this._invIdxs[fieldOption.field]=new inverted_index_InvertedIndex(fieldOption)}this._id=id,this._docs=new Set,this._idxSearcher=new index_searcher_IndexSearcher(this._invIdxs,this._docs)}static register(){common_plugin.a.FullTextSearch=full_text_search_FullTextSearch}addDocument(doc,id=doc[this._id]){let fieldNames=Object.keys(this._invIdxs);for(let fieldName,i=0;fieldNames.length,fieldName=fieldNames[i];i++){let field=doc[fieldName];if(null!=field){if("string"!=typeof field){if("number"!=typeof field)throw TypeError("Unsupported field type for full text search.");field=field.toString()}this._invIdxs[fieldName].insert(field,id)}}this._docs.add(id),this._idxSearcher.setDirty()}removeDocument(doc,id=doc[this._id]){let fieldNames=Object.keys(this._invIdxs);for(let i=0;i<fieldNames.length;i++)this._invIdxs[fieldNames[i]].remove(id);this._docs.delete(id),this._idxSearcher.setDirty()}updateDocument(doc,id=doc[this._id]){this.removeDocument(doc,id),this.addDocument(doc,id)}clear(){for(let id of this._docs)this.removeDocument(null,id)}search(query){return this._idxSearcher.search(query)}toJSON(){let serialized={id:this._id,ii:{}},fieldNames=Object.keys(this._invIdxs);for(let i=0;i<fieldNames.length;i++){const fieldName=fieldNames[i];serialized.ii[fieldName]=this._invIdxs[fieldName].toJSON()}return serialized}static fromJSONObject(serialized,analyzers={}){let fts=new full_text_search_FullTextSearch([],serialized.id),fieldNames=Object.keys(serialized.ii);for(let i=0;i<fieldNames.length;i++){const fieldName=fieldNames[i];fts._invIdxs[fieldName]=inverted_index_InvertedIndex.fromJSONObject(serialized.ii[fieldName],analyzers[fieldName])}return fts}}__webpack_require__.d(__webpack_exports__,"FullTextSearch",(function(){return full_text_search_FullTextSearch})),__webpack_require__.d(__webpack_exports__,"analyze",(function(){return analyze})),__webpack_require__.d(__webpack_exports__,"StandardAnalyzer",(function(){return analyzer_StandardAnalyzer})),__webpack_require__.d(__webpack_exports__,"whitespaceTokenizer",(function(){return whitespaceTokenizer})),__webpack_require__.d(__webpack_exports__,"lowercaseTokenFilter",(function(){return lowercaseTokenFilter})),__webpack_require__.d(__webpack_exports__,"uppercaseTokenFilter",(function(){return uppercaseTokenFilter})),full_text_search_FullTextSearch.Analyzer={},full_text_search_FullTextSearch.Analyzer.analyze=analyze,full_text_search_FullTextSearch.Analyzer.StandardAnalyzer=analyzer_StandardAnalyzer,full_text_search_FullTextSearch.Tokenizer={},full_text_search_FullTextSearch.Tokenizer.whitespaceTokenizer=whitespaceTokenizer,full_text_search_FullTextSearch.TokenFilter={},full_text_search_FullTextSearch.TokenFilter.lowercaseTokenFilter=lowercaseTokenFilter,full_text_search_FullTextSearch.TokenFilter.uppercaseTokenFilter=uppercaseTokenFilter;__webpack_exports__.default=full_text_search_FullTextSearch},function(module,exports){var g;g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(g=window)}module.exports=g}])}))}}]);
//# sourceMappingURL=plugin.js.fb8c729486a10c701ca8.bundle.js.map