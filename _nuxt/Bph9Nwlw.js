import{fromEvent as xt,startWith as gt,map as W,share as tt,debounce as Ct,timer as Tt,combineLatest as ee,shareReplay as Dt,pluck as qt,bufferCount as re,filter as ne}from"./CIDuu9oh.js";function et(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function It(t,e){let{x:r,y:n,z:i}=e,{x:s,y:o,z:h,w:c}=t,u=c*r+o*i-h*n,y=c*n+h*r-s*i,m=c*i+s*n-o*r,S=-s*r-o*n-h*i,q=u*c+S*-s+y*-h-m*-o,H=y*c+S*-o+m*-s-u*-h,a=m*c+S*-h+u*-o-y*-s;return new e.constructor(q,H,a)}var wt=Math.PI,ht=Math.PI*2;function Q(t){let e=t%ht;return e<-wt?e+=ht:e>wt&&(e-=ht),e}function ie(t){return t>-1?t<1?Math.acos(t):0:wt}function se(t,[e,r,n]){let[i,s,o]=t;return new t.constructor(new i.constructor(i.x*e.x+s.x*e.y+o.x*e.z,i.y*e.x+s.y*e.y+o.y*e.z,i.z*e.x+s.z*e.y+o.z*e.z),new i.constructor(i.x*r.x+s.x*r.y+o.x*r.z,i.y*r.x+s.y*r.y+o.y*r.z,i.z*r.x+s.z*r.y+o.z*r.z),new i.constructor(i.x*n.x+s.x*n.y+o.x*n.z,i.y*n.x+s.y*n.y+o.y*n.z,i.z*n.x+s.z*n.y+o.z*n.z))}function oe(t,{x:e,y:r,z:n}){let[i,s,o]=t;return new i.constructor(i.x*e+s.x*r+o.x*n,i.y*e+s.y*r+o.y*n,i.z*e+s.z*r+o.z*n)}function he(t,[e,r,n]){return new t.constructor(t.dot(e),t.dot(r),t.dot(n))}function V(t){return typeof t=="number"||(t==null?void 0:t.constructor)===Number}var ue=t=>{try{I(t),U(t,4)}catch(e){console.error("error while hijackDOMPoint"),console.error(e)}},B=0,zt=1,St=2,vt=3,G=9999999999999,K=void 0,Lt=Symbol("vector length"),rt=Symbol("get source"),Jt=Symbol("checked"),x=K,J,D,le=[0,1,2,6,24,120,720,5760,51840,518400,5702400,68428800,889574400,12454041600,186810624e3],mt=[],j=-1,ut=!1,Vt=[];function lt(t,e,r){x=t,j=-1,D=1;let n=e(r);if(!V(n))throw new Error(`
      your assigned progress did not not return a primitive!
      calc() does not support logical operators (|| && ==) directly

      instead of calc(() => v1 || v2);
      use        calc(() => +v1 || +v2);

      instead of calc(() => v1);
      use        calc(v1);
      `);return n}function Z(t){let e=t[rt];return e?e(t).length:t[Lt]||3}function ce(t,e){return Z(t)>Z(e)?t:e}function ae(t,e){if(D+=1,e===G)return D;if(e>=Z(t))return 0;let r=t[rt];if(r)return 1*r(t)[e];if(e===B)return 1*t.x;if(e===zt)return 1*t.y;if(e===St)return 1*t.z;if(e===vt)return 1*t.w}function Pt(t,e,r){let n=t[rt];if(n){n(t)[e]=r;return}if(e===B){t.x=r;return}if(e===zt){t.y=r;return}e===St&&(t.z=r),e===vt&&(t.w=r)}function F(t,e){if(typeof t!="function")throw new Error("no function assigned");if(x!==K)throw new Error("something wrong, do you use calc() inside calc?");try{let r=typeof e>"u",n=typeof e=="function",i=!n&&!r?e:void 0,s=lt(B,t,i);if(r&&typeof J>"u")return s;let o=J?Z(J):0;if(o===G){if(!t[Jt]){let y=lt(G,t),m=le[D];if(Math.abs(y-m)>Number.EPSILON)throw new Error(`
            algebraic multiplication works only in calls with *

            calc(() => v * m);
            calc(() => m * v);
            calc(() => m * m);
            calc(() => m * m * v);

            `);t[Jt]=!0}let u=mt[0];for(let y=1;y<D-1;y+=1){let m=mt[y];if(!u.multiply)throw new Error(`cannot find method multiply() on ${u}`);u=u.multiply(m)}return u}let h=n?e.length:o;if(h||(h=o),h<o)throw new Error("Your assigned result Vector cant use higher space Operands than it has");let c=new Array(h);c[0]=s,i&&Pt(i,x,c[0]);for(let u=1;u<h;u+=1){let y=lt(u,t,i);c[u]=y,i&&Pt(i,x,y)}return r?new J.constructor(...c):n?e(...c):i}finally{x=K,J=void 0}}function I(t,e){let r=t.prototype;r[rt]=e;let n=r[Symbol.toPrimitive]||function(i){return i==="string"?this.toString():this.valueOf()};r[Symbol.toPrimitive]=function(i){return x===B&&(J=J?ce(J,this):this,mt[D-1]=this),x===K?n.call(this,i):ae(this,x)}}function Et(t){return function(...e){if(x===B){if(ut)return t.apply(this,e);try{ut=!0,j+=1;let r=t.apply(this,e);return Vt[j]=r,r}finally{ut=!1}}return x===zt||x===St||x===vt?(j+=1,Vt[j]):t.apply(this,e)}}function f(t,e){let r=t.prototype,n=r[e];r[e]=Et(n)}function nt(t,e){let r=t.prototype,n=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(r,e,{get:Et(function(){return n.get.call(this)})})}function U(t,e){let r=t.prototype;Object.defineProperty(r,Lt,{value:e})}function jt(t){U(t,G)}function Ot(t){return Et(t)}typeof DOMPoint<"u"&&ue(DOMPoint);function ye(t){let e="";return t&&(e=`${t}-`),e}function Y(t,e,r={}){let n=ye(t);return Object.entries(e).forEach(([i,s])=>{r[`--${n}${i}`]=s}),r}var ft=0,pt=1,g=Symbol("axes");function we(t,e,r,n){let i=Math.atan2(t,e),s=Math.atan2(r,n);return Q(i-s)}function At(t){return t*t}var z=class{constructor(t,e){typeof t=="function"?F(t,(r,n)=>{this[g]=[r,n]}):et(t)?this[g]=[...t]:t&&V(t.x)?this[g]=[t.x||0,t.y||0]:this[g]=[t||0,e||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){let{length:t}=this;return new this.constructor(this.x/t,this.y/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y}getRad(){return Q(Math.atan2(this.y,this.x))}angleTo(t){return we(this.y,this.x,t.y,t.x)}rotate(t){let e=Math.sin(t),r=Math.cos(t),n=this.x*r-this.y*e,i=this.x*e+this.y*r;return new this.constructor(n,i)}distance(t){return Math.sqrt(At(this.x-t.x)+At(this.y-t.y))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y}toJSON(){return{x:this.x,y:this.y}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e){return Y(t,this.toJSON(),e)}get lengthSq(){return this.dot(this)}get length(){return Math.sqrt(this.lengthSq)}get lensq(){return this.lengthSq}get len(){return this.length}get x(){return this[g][ft]}set x(t){throw new Error("set x() not implemented")}get y(){return this[g][pt]}set y(t){throw new Error("set y() not implemented")}get z(){throw new Error("get z() not implemented")}set z(t){throw new Error("set z() not implemented")}[Symbol.iterator](){return this[g].values()}};I(z);U(z,2);f(z,"dot");f(z,"angleTo");f(z,"distance");f(z,"toArray");f(z,"getRad");nt(z,"length");nt(z,"lengthSq");var me=class Rt extends z{set x(e){this[g][ft]=e}set y(e){this[g][pt]=e}get x(){return this[g][ft]}get y(){return this[g][pt]}calc(e){return F(e,this)}clone(){return new Rt(this.x,this.y)}},R=class extends z{toPoint(){return new me(this.x,this.y)}},fe=Ot((t,e)=>new R(t,e)),it=(t,e)=>fe(t,e);it(0,0);it(0,-1);it(-1,0);var k=0,C=1,T=2,l=Symbol("axes");function ct(t){return t*t}var p=class{constructor(t,e,r){typeof t=="function"?F(t,(n,i,s)=>{this[l]=[n,i,s]}):et(t)?this[l]=[...t]:t&&V(t.x)?this[l]=[t.x||0,t.y||0,t.z||0]:this[l]=[t||0,e||0,r||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){let{length:t}=this;return new this.constructor(this.x/t,this.y/t,this.z/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new this.constructor(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossNormalize(t){let e=this.cross(t),{length:r}=e;return e[l][k]/=r,e[l][C]/=r,e[l][T]/=r,e}cn(t){return this.crossNormalize(t)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length)}}angleTo(t){return Q(ie(this.dot(t)/(this.length*t.length)))}multiply(t){return t.x===void 0?this.multiplyMat3(t):t.w===void 0?this.multiplyVec3(t):It(t,this)}multiplyMat3(t){return he(this,t)}multiplyVec3({x:t,y:e,z:r}){return new this.constructor(this.x*t,this.y*e,this.z*r)}distance(t){return Math.sqrt(ct(this.x-t.x)+ct(this.y-t.y)+ct(this.z-t.z))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y,this.z]}swizzle(t){let e=t.split("").map(r=>this[r]);return e.length===2?new R(e[0],e[1]):new this.constructor(e[0],e[1],e[2])}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}toJSON(){return{x:this.x,y:this.y,z:this.z}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e){return Y(t,this.toJSON(),e)}get lengthSq(){return this.dot(this)}set lengthSq(t){throw new Error("set lengthSq() not implemented")}get length(){return Math.sqrt(this.lengthSq)}set length(t){throw new Error("set length() not implemented")}get lensq(){return this.lengthSq}set lensq(t){throw new Error("set lensq() not implemented")}get len(){return this.length}set len(t){throw new Error("set len() not implemented")}get x(){return this[l][k]}set x(t){throw new Error("set x() not implemented")}get y(){return this[l][C]}set y(t){throw new Error("set y() not implemented")}get z(){return this[l][T]}set z(t){throw new Error("set z() not implemented")}get xy(){return new R(this[l][k],this[l][C])}set xy(t){throw new Error("set xz() not implemented")}get xz(){return new R(this[l][k],this[l][T])}set xz(t){throw new Error("set xz() not implemented")}get yz(){return new R(this[l][C],this[l][T])}set yz(t){throw new Error("set yz() not implemented")}[Symbol.iterator](){return this[l].values()}};I(p);U(p,3);f(p,"dot");f(p,"cross");f(p,"crossNormalize");f(p,"toAngles");f(p,"angleTo");f(p,"rotate");f(p,"distance");f(p,"toArray");nt(p,"length");nt(p,"lengthSq");var pe=class $t extends p{set x(e){this[l][k]=e}set y(e){this[l][C]=e}set z(e){this[l][T]=e}get x(){return this[l][k]}get y(){return this[l][C]}get z(){return this[l][T]}calc(e){return F(e,this)}clone(){return new $t(this.x,this.y,this.z)}},st=class extends p{toVector(){return new pe(this.x,this.y,this.z)}clone(){return this}},de=Ot((t,e,r)=>new st(t,e,r)),P=(t,e,r)=>de(t,e,r);P(0,0,0);var Wt=P(0,0,-1);P(0,0,1);var bt=P(-1,0,0);P(1,0,0);var Qt=P(0,1,0);P(0,-1,0);P(1,1,1);var E=Symbol("angle rad"),Bt=Math.PI/180,_=class Ft{constructor(e){e instanceof Ft?this[E]=e[E]:this[E]=Q(e*Bt)}valueOf(){return this[E]}toJSON(){return{angle:this[E]}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,r){return Y(e,this.toJSON(),r)}},Ut=class extends _{set(t){t instanceof _?this[E]=t[E]:this[E]=Q((t||0)*Bt)}},xe=class extends _{toDegree(){return new Ut(this[E])}};new xe(0);function ge(t){return new Ut(t)}function ze(t){return V(t)||t instanceof _}var O=0,b=1,M=2,N=3,w=Symbol("axes"),Se=Symbol("forward cache"),ve=Symbol("left cache"),Ee=Symbol("up cache"),Oe=Symbol("inverse cache");function be([t,e,r,n]){return Math.sqrt(t*t+e*e+r*r+n*n)}function Yt(t){let e=be(t);t[O]/=e,t[b]/=e,t[M]/=e,t[N]/=e}function Me(t,e){let r=t.normalize(),n=e.crossNormalize(r),i=r.crossNormalize(n),s=n.x,o=n.y,h=n.z,c=i.x,u=i.y,y=i.z,m=r.x,S=r.y,q=r.z,H=s+u+q,a=new Array(4);if(H>0){let d=Math.sqrt(H+1);return a[N]=d*.5,d=.5/d,a[O]=(y-S)*d,a[b]=(m-h)*d,a[M]=(o-c)*d,a}if(s>=u&&s>=q){let d=Math.sqrt(1+s-u-q),A=.5/d;return a[O]=.5*d,a[b]=(o+c)*A,a[M]=(h+m)*A,a[N]=(y-S)*A,a}if(u>q){let d=Math.sqrt(1+u-s-q),A=.5/d;return a[O]=(c+o)*A,a[b]=.5*d,a[M]=(S+y)*A,a[N]=(m-h)*A,a}let Nt=Math.sqrt(1+q-s-u),ot=.5/Nt;return a[O]=(m+h)*ot,a[b]=(S+y)*ot,a[M]=.5*Nt,a[N]=(o-c)*ot,a}function Ne(t,e){let r=new Array(4),n=e*.5,i=Math.sin(n),s=Math.cos(n);return r[O]=i*t.x,r[b]=i*t.y,r[M]=i*t.z,r[N]=s,r}function dt(t,e,r,n){if(V(t))return[t,e,r,n];if(et(t))return[...t];if(ze(e))return Ne(t,e);if(t&&e)return Me(t,e)}function Ht(t,e,r,n){return t&&V(t.w)?dt(t.x,t.y,t.z,t.w):dt(t,e,r,n)||[0,0,0,1]}var $=class{constructor(t,e,r,n){this[w]=Ht(t,e,r,n),Yt(this[w])}set(t,e,r,n){throw new Error("set x() not implemented")}multiply(t,e,r,n){if(V(t.w))return this.multiplyQuaternion(t);let i=dt(t,e,r,n);return i?this.multiplyQuaternion(new this.constructor(i)):this.multiplyVector(t)}multiplyVector(t){return It(this,t)}multiplyQuaternion(t){let e=this.x,r=this.y,n=this.z,i=this.w,s=t.x,o=t.y,h=t.z,c=t.w,u=i*s+e*c+r*h-n*o,y=i*o+r*c+n*s-e*h,m=i*h+n*c+e*o-r*s,S=i*c-e*s-r*o-n*h;return new this.constructor(u,y,m,S)}mul(t,e,r,n){return this.multiply(t,e,r,n)}get inverse(){let{x:t,y:e,z:r,w:n}=this;return this.constructor(t*-1,e*-1,r*-1,n)}get inv(){return this.inverse}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}get left(){return this.multiplyVector(bt)}get dir(){return this.multiplyVector(Wt)}get up(){return this.multiplyVector(Qt)}get 0(){return this.left}get 1(){return this.dir}get 2(){return this.up}get x(){return this[w][O]}set x(t){throw new Error("set x() not implemented")}get y(){return this[w][b]}set y(t){throw new Error("set y() not implemented")}get z(){return this[w][M]}set z(t){throw new Error("set z() not implemented")}get w(){return this[w][N]}set w(t){throw new Error("set w() not implemented")}toJSON(){let{x:t,y:e,z:r,w:n}=this;return{x:t,y:e,z:r,w:n,a1:1-e*e*2-r*r*2,a2:t*e*2-r*n*2,a3:t*r*2+e*n*2,b1:t*e*2+r*n*2,b2:1-t*t*2-r*r*2,b3:e*r*2-t*n*2,c1:t*r*2-e*n*2,c2:e*r*2+t*n*2,c3:1-t*t*2-e*e*2}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e){return Y(t,this.toJSON(),e)}};I($);jt($);var qe=class extends ${set(t,e,r,n){t instanceof $?this[w]=[...t[w]]:(this[w]=Ht(t,e,r,n),Yt(this[w]))}set x(t){this[w][O]=t}set y(t){this[w][b]=t}set z(t){this[w][M]=t}set w(t){this[w][N]=t}get x(){return this[w][O]}get y(){return this[w][b]}get z(){return this[w][M]}get w(){return this[w][N]}};function X(t,e,r){let n=t[e];return n||(n=r(),t[e]=n),n}var Xt=class extends ${get left(){return X(this,ve,()=>this.multiplyVector(bt))}get dir(){return X(this,Se,()=>this.multiplyVector(Wt))}get up(){return X(this,Ee,()=>this.multiplyVector(Qt))}get inverse(){return X(this,Oe,()=>{let{x:t,y:e,z:r,w:n}=this;return this.constructor(t*-1,e*-1,r*-1,n)})}};new qe;var Je=Ot((t,e,r,n)=>new Xt(t,e,r,n)),Ve=(t,e,r,n)=>Je(t,e,r,n);new Xt(bt,ge(90));Ve(0,0,0,1);var Pe=0,Ae=1,ke=2,Ce=3,v=Symbol("axes"),Mt=class{constructor(t,e,r,n){typeof t=="function"?F(t,(i,s,o,h)=>{this[v]=[i,s,o,h]}):et(t)?this[v]=[...t]:t&&V(t.x)?this[v]=[t.x||0,t.y||0,t.z||0,t.w||0]:this[v]=[t||0,e||0,r||0,n||0]}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}toArray(){return[this.x,this.y,this.z,this.w]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e){return Y(t,this.toJSON(),e)}get x(){return this[v][Pe]}set x(t){throw new Error("set x() not implemented")}get y(){return this[v][Ae]}set y(t){throw new Error("set y() not implemented")}get z(){return this[v][ke]}set z(t){throw new Error("set z() not implemented")}get w(){return this[v][Ce]}set w(t){throw new Error("set w() not implemented")}[Symbol.iterator](){return this[v].values()}};I(Mt);U(Mt,4);f(Mt,"toArray");var L=Symbol("data"),Gt=class Kt{constructor(...e){this[L]=e}get 0(){return this[L][0]}set 0(e){throw new Error("set [0] not implemented")}get 1(){return this[L][1]}set 1(e){throw new Error("set [1] not implemented")}get 2(){return this[L][2]}set 2(e){throw new Error("set [2] not implemented")}multiplyMat(e){return se(this,e)}multiplyVec(e){return oe(this,e)}multiply(e){if(e instanceof Kt)return this.multiplyMat(e);let{x:r,y:n,z:i}=e;if(r===void 0||n===void 0||i===void 0)throw new Error(`multiply only works with mat3 and vec3, not supported ${e}`);return this.multiplyVec(e)}[Symbol.iterator](){return this[L].values()}};I(Gt);jt(Gt);const at=new Map;Zt();function Zt(t=window){return at.has(t)||at.set(t,xt(t,"scroll",{passive:!0})),at.get(t).pipe(gt(0),W(()=>_t(t)),tt())}function _t(t=window){const e=window.document,r=e&&e.documentElement||{scrollLeft:0,scrollTop:0};return new st(t.scrollLeft||window.pageXOffset||r.scrollLeft,t.scrollTop||window.pageYOffset||r.scrollTop)}const Te=xt(window,"resize").pipe(gt(0),Ct(()=>Tt(350)),W(()=>te()),tt());let yt=_t();const De=Zt().pipe(W(t=>{const e=it(t.x,Math.max(t.y,0),t.z),r=new st(()=>(e-yt)/Math.abs(e-yt));return yt=e,{position:t,direction:r}}),tt());xt(window,"orientationchange").pipe(gt(0),Ct(()=>Tt(350)),W(()=>te()),tt());function te(){const t=typeof window<"u"&&window,e=typeof t.document<"u"&&t.document,r=e&&e.documentElement;return new st(kt(r.clientWidth,t.innerWidth),kt(r.clientHeight,t.innerHeight))}function kt(t,e){return t<e?e:t}const Ie=ee(Te,De).pipe(Dt({refCount:!0,bufferSize:1})),Le=6,Re=Ie.pipe(qt(1)).pipe(qt("direction")).pipe(re(Le,1)).pipe(W(t=>t.reduce((e,r)=>e+r.y,0)/t.length)).pipe(ne(t=>!(t%1))).pipe(Dt({refCount:!0,bufferSize:1}));export{Re as directionDetectionObserver,Ie as viewportObserver};
